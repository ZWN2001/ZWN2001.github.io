<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>FLutteræ€§èƒ½ä¼˜åŒ– | ZWN's blog</title><meta name="author" content="æ´›é›ª"><meta name="copyright" content="æ´›é›ª"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="FLutteræ€§èƒ½ä¼˜åŒ– å‡†å¤‡ ä»¥ profile æ¨¡å¼å¯åŠ¨åº”ç”¨ï¼Œå¦‚æœæ˜¯æ··åˆ Flutter åº”ç”¨ï¼Œåœ¨ Flutter SDKçš„flutter&#x2F;packages&#x2F;flutter_tools&#x2F;gradle&#x2F;flutter.gradle çš„ buildModeFor æ–¹æ³•ä¸­å°† debug æ¨¡å¼æ”¹ä¸º profileå³å¯ã€‚  å½“ç„¶ï¼Œå¦‚éå¿…è¦ï¼Œä¸å¤ªå»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼  ä½ç½®å¦‚å›¾ï¼š Run &gt; Flutt"><meta property="og:type" content="article"><meta property="og:title" content="FLutteræ€§èƒ½ä¼˜åŒ–"><meta property="og:url" content="https://zwn2001.space/posts/FLutter%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/index.html"><meta property="og:site_name" content="ZWN&#39;s blog"><meta property="og:description" content="FLutteræ€§èƒ½ä¼˜åŒ– å‡†å¤‡ ä»¥ profile æ¨¡å¼å¯åŠ¨åº”ç”¨ï¼Œå¦‚æœæ˜¯æ··åˆ Flutter åº”ç”¨ï¼Œåœ¨ Flutter SDKçš„flutter&#x2F;packages&#x2F;flutter_tools&#x2F;gradle&#x2F;flutter.gradle çš„ buildModeFor æ–¹æ³•ä¸­å°† debug æ¨¡å¼æ”¹ä¸º profileå³å¯ã€‚  å½“ç„¶ï¼Œå¦‚éå¿…è¦ï¼Œä¸å¤ªå»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼  ä½ç½®å¦‚å›¾ï¼š Run &gt; Flutt"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://zwn2001.space/img/cover3/1-min.jpg"><meta property="article:published_time" content="2022-09-19T01:13:39.000Z"><meta property="article:modified_time" content="2023-08-27T11:58:32.678Z"><meta property="article:author" content="æ´›é›ª"><meta property="article:tag" content="flutter"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://zwn2001.space/img/cover3/1-min.jpg"><link rel="shortcut icon" href="/img/favicon.webp"><link rel="canonical" href="https://zwn2001.space/posts/FLutter%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!0,top_n_per_article:-1,unescape:!1,languages:{hits_empty:"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}",hits_stats:"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç®€"},noticeOutdate:{limitDay:200,position:"top",messagePrev:"è·ç¦»ä¸Šæ¬¡æ›´æ–°å·²ç»è¿‡å»",messageNext:"å¤©å•¦ï¼æ³¨æ„å†…å®¹å¯èƒ½è¿‡æ—¶ã€‚"},highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:300},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶é”™è¯¯",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!1,post:!1},runtime:"å¤©",dateSuffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://unpkg.com/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://unpkg.com/flickr-justified-gallery/dist/fjGallery.css"}},isPhotoFigcaption:!0,islazyload:!0,isAnchor:!0,percent:{toc:!0,rightside:!0},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"FLutteræ€§èƒ½ä¼˜åŒ–",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-08-27 19:58:32"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,t={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(t)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.getCSS=(o,n=!1)=>new Promise((t,e)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=o,n&&(a.id=n),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/transpancy.css"><link rel="stylesheet" href="/css/iconfont.css"><link rel="stylesheet" href="/css/rightmenu.css"><link rel="stylesheet" href="/css/loadimg.css"><link rel="stylesheet" href="/css/project.css"><link type="text/html" rel="stylesheet" href="/css/wide_screen.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"><style>#recent-posts>.recent-post-item>.recent-post-info>.article-meta-wrap>.tags:before{content:"\A";white-space:pre}#recent-posts>.recent-post-item>.recent-post-info>.article-meta-wrap>.tags>.article-meta__separator{display:none}</style><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" src="/img/favicon.webp"><div class="loading-image-dot"></div><div id="loading-percentage"></div></div></div><script>const loadingPercentage=document.getElementById("loading-percentage");loadingPercentage.style.color="black";let loadingPercentageTimer=setInterval(function(){var e=document.querySelector(".pace-progress");e&&(e=e.getAttribute("data-progress-text"))!==loadingPercentage.textContent&&"60%"===(loadingPercentage.textContent=e)&&clearInterval(loadingPercentageTimer)},100);const preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",()=>{preloader.endLoading()})</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.webp" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">139</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">7</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/cover3/1-min.jpg)"><nav id="nav"><span id="blog-info"><a href="/" title="ZWN's blog"><span class="site-name">ZWN's blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">FLutteræ€§èƒ½ä¼˜åŒ–</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2022-09-19T01:13:39.000Z" title="å‘è¡¨äº 2022-09-19 09:13:39">2022-09-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-08-27T11:58:32.678Z" title="æ›´æ–°äº 2023-08-27 19:58:32">2023-08-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B%E7%9F%A5%E8%AF%86/">ç¼–ç¨‹çŸ¥è¯†</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">6.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>25åˆ†é’Ÿ</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>FLutteræ€§èƒ½ä¼˜åŒ–</h1><h2 id="å‡†å¤‡">å‡†å¤‡</h2><p>ä»¥ profile æ¨¡å¼å¯åŠ¨åº”ç”¨ï¼Œå¦‚æœæ˜¯æ··åˆ Flutter åº”ç”¨ï¼Œåœ¨ Flutter SDKçš„<code>flutter/packages/flutter_tools/gradle/flutter.gradle</code> çš„ buildModeFor æ–¹æ³•ä¸­å°† debug æ¨¡å¼æ”¹ä¸º profileå³å¯ã€‚</p><blockquote><p>å½“ç„¶ï¼Œå¦‚éå¿…è¦ï¼Œä¸å¤ªå»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼</p></blockquote><p>ä½ç½®å¦‚å›¾ï¼š</p><p><strong>Run &gt; Flutter Run main.dart in Profile Mode</strong></p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="1.png" style="zoom:30%"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2.png" style="zoom:30%"><p>ä¸è°ƒè¯•ä»£ç å¯ä»¥åœ¨è°ƒè¯•æ¨¡å¼ä¸‹æ£€æµ‹ Bug ä¸åŒï¼Œæ€§èƒ½é—®é¢˜éœ€è¦åœ¨å‘å¸ƒæ¨¡å¼ä¸‹ä½¿ç”¨çœŸæœºè¿›è¡Œæ£€æµ‹ã€‚è¿™æ˜¯å› ä¸ºï¼Œç›¸æ¯”å‘å¸ƒæ¨¡å¼è€Œè¨€ï¼Œ<strong>è°ƒè¯•æ¨¡å¼å¢åŠ äº†å¾ˆå¤šé¢å¤–çš„æ£€æŸ¥ï¼ˆæ¯”å¦‚æ–­è¨€ï¼‰ï¼Œè¿™äº›æ£€æŸ¥å¯èƒ½ä¼šè€—è´¹å¾ˆå¤šèµ„æºï¼Œè€Œæ›´é‡è¦çš„æ˜¯ï¼Œè°ƒè¯•æ¨¡å¼ä½¿ç”¨ JIT æ¨¡å¼è¿è¡Œåº”ç”¨ï¼Œä»£ç æ‰§è¡Œæ•ˆç‡è¾ƒä½ã€‚è¿™å°±ä½¿å¾—è°ƒè¯•æ¨¡å¼è¿è¡Œçš„åº”ç”¨ï¼Œæ— æ³•çœŸå®åæ˜ å‡ºå®ƒçš„æ€§èƒ½é—®é¢˜</strong>ã€‚</p><p>è€Œå¦ä¸€æ–¹é¢ï¼Œ<strong>æ¨¡æ‹Ÿå™¨ä½¿ç”¨çš„æŒ‡ä»¤é›†ä¸º x86ï¼Œè€ŒçœŸæœºä½¿ç”¨çš„æŒ‡ä»¤é›†æ˜¯ ARM</strong>ã€‚è¿™ä¸¤ç§æ–¹å¼çš„äºŒè¿›åˆ¶ä»£ç æ‰§è¡Œè¡Œä¸ºå®Œå…¨ä¸åŒï¼Œå› æ­¤ï¼Œæ¨¡æ‹Ÿå™¨ä¸çœŸæœºçš„æ€§èƒ½å·®å¼‚è¾ƒå¤§ï¼Œä¾‹å¦‚ï¼Œé’ˆå¯¹ä¸€äº› x86 æŒ‡ä»¤é›†æ“…é•¿çš„æ“ä½œï¼Œæ¨¡æ‹Ÿå™¨ä¼šæ¯”çœŸæœºå¿«ï¼Œè€Œå¦ä¸€äº›æ“ä½œåˆ™ä¼šæ¯”çœŸæœºæ…¢ã€‚è¿™ä¹ŸåŒæ—¶æ„å‘³ç€ï¼Œä½ æ— æ³•ä½¿ç”¨æ¨¡æ‹Ÿå™¨æ¥è¯„ä¼°çœŸæœºæ‰èƒ½å‡ºç°çš„æ€§èƒ½é—®é¢˜ã€‚</p><p>Â </p><h3 id="Flutter-Inspector">Flutter Inspector</h3><h4 id="Repaint-Rainbow">Repaint Rainbow</h4><p>ç‚¹å‡» â€œRepaint Rainbowâ€ å›¾æ ‡ï¼Œå®ƒä¼š <strong>ä¸ºæ‰€æœ‰ RenderBox ç»˜åˆ¶ä¸€å±‚å¤–æ¡†ï¼Œå¹¶åœ¨å®ƒä»¬é‡ç»˜æ—¶ä¼šæ”¹å˜é¢œè‰²</strong>ã€‚</p><h4 id="ä½œç”¨">ä½œç”¨</h4><p><strong>å¸®ä½ æ‰¾åˆ° App ä¸­é¢‘ç¹é‡ç»˜å¯¼è‡´æ€§èƒ½æ¶ˆè€—è¿‡å¤§çš„éƒ¨åˆ†</strong>ã€‚</p><p>ä¾‹å¦‚ï¼šä¸€ä¸ªå°åŠ¨ç”»å¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªé¡µé¢é‡ç»˜ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨ RepaintBoundary Widget åŒ…è£¹å®ƒï¼Œå¯ä»¥å°†é‡ç»˜èŒƒå›´ç¼©å°è‡³æœ¬èº«æ‰€å ç”¨çš„åŒºåŸŸï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘ç»˜åˆ¶æ¶ˆè€—ã€‚</p><h4 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h4><p>ä¾‹å¦‚ <strong>é¡µé¢çš„è¿›åº¦æ¡åŠ¨ç”»åˆ·æ–°æ—¶ä¼šå¯¼è‡´æ•´ä¸ªå¸ƒå±€é¢‘ç¹é‡ç»˜</strong>ã€‚</p><h4 id="ç¼ºç‚¹">ç¼ºç‚¹</h4><p>ä½¿ç”¨ RepaintBoundary Widget ä¼šåˆ›å»ºé¢å¤–çš„ç»˜åˆ¶ç”»å¸ƒï¼Œè¿™å°†ä¼šå¢åŠ ä¸€å®šçš„å†…å­˜æ¶ˆè€—ã€‚</p><p>Â </p><h3 id="ä½¿ç”¨æ€§èƒ½è§†å›¾-Performance-view">ä½¿ç”¨æ€§èƒ½è§†å›¾ (Performance view)</h3><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="4.png" style="zoom:30%"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="5.png" alt="ä¸€äº›å¯èƒ½çš„å…³æ³¨ç‚¹" style="zoom:30%"><h4 id="å¸§äº‹ä»¶å›¾ï¼š">å¸§äº‹ä»¶å›¾ï¼š</h4><p>UI çº¿ç¨‹æ‰§è¡Œ Dart VM ä¸­çš„ Dart ä»£ç ã€‚å®ƒåŒ…æ‹¬ä½ çš„åº”ç”¨ç¨‹åºå’Œ Flutter æ¡†æ¶çš„æ‰€æœ‰ä»£ç ã€‚å½“ä½ åˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼Œ UI çº¿ç¨‹ä¼šåˆ›å»ºä¸€ä¸ªå›¾å±‚æ ‘å’Œä¸€ä¸ªè½»é‡çº§çš„ä¸è®¾å¤‡æ— å…³çš„ç»˜åˆ¶æŒ‡ä»¤é›†ï¼Œå¹¶æŠŠå›¾å±‚æ ‘äº¤ç»™è®¾å¤‡çš„ rasterï¼ˆæ …æ ¼ï¼‰çº¿ç¨‹è¿›è¡Œæ¸²æŸ“</p><p>æ …æ ¼åŒ–çº¿ç¨‹ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰çŸ¥é“çš„ GPU çº¿ç¨‹ï¼‰æ‰§è¡Œ Flutter å¼•æ“ä¸­å›¾å½¢ç›¸å…³çš„ä»£ç ã€‚è¿™ä¸ªçº¿ç¨‹é€šè¿‡ä¸ GPU (å›¾å½¢å¤„ç†å•å…ƒ) é€šä¿¡ï¼Œè·å–å›¾å½¢æ ‘å¹¶æ˜¾ç¤ºå®ƒã€‚ä½ ä¸èƒ½ç›´æ¥è®¿é—® Raster çº¿ç¨‹æˆ–å®ƒçš„æ•°æ®ï¼Œä½†å¦‚æœè¿™ä¸ªçº¿ç¨‹è¾ƒæ…¢ï¼Œé‚£å®ƒè‚¯å®šæ˜¯ç”±ä½ çš„ Dart ä»£ç å¼•èµ·çš„ã€‚å›¾å½¢åŒ–åº“ Skia è¿è¡Œåœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šï¼Œæœ‰æ—¶å€™ä¹Ÿç§°å®ƒä¸ºå…‰æ …çº¿ç¨‹ã€‚</p><p>æœ‰æ—¶å€™ä¸€ä¸ªé¡µé¢çš„å›¾å½¢å±‚æ ‘æ¯”è¾ƒå®¹æ˜“æ„å»ºä½† raster çº¿ç¨‹çš„æ¸²æŸ“å´æ¯”è¾ƒæ˜‚è´µã€‚åœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼Œä½ éœ€è¦æ‰¾å‡ºå¯¼è‡´æ¸²æŸ“å˜æ…¢çš„ä»£ç ã€‚ä¸º GPU è®¾å®šç‰¹å®šå¤šç§ç±»å‹çš„ workload æ˜¯ç›¸å½“å›°éš¾çš„ã€‚åœ¨ä¸€äº›ç‰¹å®šçš„æƒ…å½¢ä¸‹ï¼Œå¤šä¸ªå¯¹è±¡çš„é€æ˜åº¦é‡å ã€å‰ªåˆ‡æˆ–é˜´å½±ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„ <code>saveLayer()</code> çš„è°ƒç”¨ã€‚</p><p>å¡é¡¿ (Jank)ï¼šå¸§æ¸²æŸ“å›¾è¡¨ä½¿ç”¨çº¢è‰²å›¾å±‚æ˜¾ç¤ºå¸§å»¶æ—¶ã€‚å¦‚æœä¸€å¸§çš„æ¸²æŸ“æ—¶é—´è¶…è¿‡ 16msï¼Œåˆ™ä¼šè¢«è®¤ä¸ºæ­¤å¸§æ˜¯å»¶æ—¶çš„ï¼Œä¸ºäº†è¾¾åˆ°å¸§æ¸²æŸ“é¢‘ç‡åˆ° 60 FPS (æ¯ç§’å¸§æ•°)ï¼Œæ¯ä¸€å¸§çš„æ¸²æŸ“æ—¶é—´å¿…é¡»ç­‰äºæˆ–å°‘äº 16 msã€‚å¦‚æœæ²¡æœ‰è¾¾åˆ°è¿™ä¸ªç›®æ ‡ï¼Œä½ ä¼šå‘ç° UI ä¸æµç•…æˆ–ä¸¢å¸§ã€‚</p><p>ç€è‰²å™¨æ¸²æŸ“ï¼šåœ¨ Flutter åº”ç”¨ä¸­ï¼Œç€è‰²å™¨ä¼šåœ¨åˆæ¬¡ä½¿ç”¨æ—¶å‘ç”Ÿæ¸²æŸ“ã€‚å‚ä¸äº†ç€è‰²å™¨ç¼–è¯‘çš„æ„å»ºå¸§å·²æ ‡è®°ä¸ºæ·±çº¢è‰²ã€‚</p><h4 id="æ—¶é—´çº¿äº‹ä»¶å›¾ï¼š">æ—¶é—´çº¿äº‹ä»¶å›¾ï¼š</h4><p>æ—¶é—´çº¿äº‹ä»¶å›¾æ˜¾ç¤ºäº†åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰äº‹ä»¶è·Ÿè¸ªã€‚Flutter æ¡†æ¶åœ¨æ„å»ºæ¡†æ¶ã€ç»˜åˆ¶åœºæ™¯å’Œè·Ÿè¸ª HTTP æµé‡ç­‰å…¶ä»–æ´»åŠ¨æ—¶å‘å‡ºæ—¶é—´çº¿äº‹ä»¶ã€‚è¿™äº›äº‹ä»¶ä¼šåœ¨æ—¶é—´è½´ä¸Šæ˜¾ç¤ºå‡ºæ¥ã€‚è¿˜å¯ä»¥é€šè¿‡ dart: developerTimeline å’Œ TimelineTaskAPI å‘é€è‡ªå·±çš„ Timeline äº‹ä»¶ã€‚</p><h4 id="Enhance-Tracing">Enhance Tracing</h4><blockquote><p>å¯ç”¨è¯¥é€‰é¡¹åï¼Œå¸§æ„å»ºæ—¶é—´å¯èƒ½ä¼šå—åˆ°å½±å“ã€‚</p></blockquote><p>Â </p><h2 id="æ€§èƒ½æŒ‡æ ‡">æ€§èƒ½æŒ‡æ ‡</h2><p>æ‘˜è‡ªhttps://flutter.cn/docs/perf/metrics</p><ul><li>ç¬¬ä¸€å¸§çš„å¯åŠ¨æ—¶é—´<ul><li>å½“ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://api.flutter-io.cn/flutter/widgets/WidgetsBinding/firstFrameRasterized.html">WidgetsBinding.instance.firstFrameRasterized</a> ä¸º true æ—¶æŸ¥çœ‹è€—æ—¶ã€‚</li><li>æŸ¥çœ‹ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://flutter-flutter-perf.skia.org/e/?queries=sub_result%3DtimeToFirstFrameRasterizedMicros">æ€§èƒ½æ•°æ®çœ‹æ¿</a>ã€‚</li></ul></li><li>ä¸€å¸§çš„æ„å»ºæ—¶é—´ï¼Œæ …æ ¼åŒ–æ—¶é—´ï¼Œä»¥åŠæ€»æ—¶é—´<ul><li>åœ¨ API æ–‡æ¡£ä¸­æŸ¥çœ‹ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://api.flutter-io.cn/flutter/dart-ui/FrameTiming-class.html."><code>FrameTiming</code></a> ã€‚</li></ul></li><li>ä¸€å¸§çš„æ„å»ºæ—¶é—´ <code>buildDuration</code> (<code>*_frame_build_time_millis</code>)<ul><li>æˆ‘ä»¬å»ºè®®ç›‘æµ‹å››ä¸ªæ•°æ®ï¼šå¹³å‡å€¼ã€90 åˆ†ä½å€¼ã€99 åˆ†ä½å€¼å’Œæœ€å·®å¸§æ„å»ºæ—¶é—´ã€‚</li><li>ä¾‹å¦‚ï¼ŒæŸ¥çœ‹ <code>flutter_gallery__transition_perf</code> æµ‹è¯•æ¡ˆä¾‹ä¸­çš„ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://flutter-flutter-perf.skia.org/e/?queries=sub_result%3D90th_percentile_frame_build_time_millis%26sub_result%3D99th_percentile_frame_build_time_millis%26sub_result%3Daverage_frame_build_time_millis%26sub_result%3Dworst_frame_build_time_millis%26test%3Dflutter_gallery__transition_perf">æ„å»ºæ•°æ®</a> ã€‚</li></ul></li><li>ä¸€å¸§çš„æ …æ ¼åŒ–æ—¶é—´ <code>rasterDuration</code> (<code>*_frame_build_time_millis</code>)<ul><li>æˆ‘ä»¬å»ºè®®ç›‘æµ‹å››ä¸ªæ•°æ®ï¼šå¹³å‡å€¼ã€90 åˆ†ä½å€¼ã€99 åˆ†ä½å€¼å’Œæœ€å·®å¸§æ„å»ºæ—¶é—´ã€‚</li><li>ä¾‹å¦‚ï¼ŒæŸ¥çœ‹ <code>flutter_gallery__transition_perf</code> æµ‹è¯•æ¡ˆä¾‹ä¸­çš„ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://flutter-flutter-perf.skia.org/e/?queries=sub_result%3D90th_percentile_frame_build_time_millis%26sub_result%3D99th_percentile_frame_build_time_millis%26sub_result%3Daverage_frame_build_time_millis%26sub_result%3Dworst_frame_build_time_millis%26test%3Dflutter_gallery__transition_perf">æ …æ ¼åŒ–æ•°æ®</a> ã€‚</li></ul></li><li>CPU/GPU çš„ä½¿ç”¨æƒ…å†µï¼ˆä¸€ä¸ªå¯ä»¥è¿‘ä¼¼è¡¡é‡åŠŸè€—çš„æŒ‡æ ‡ï¼‰<ul><li>è¯¥æ•°æ®ç›®å‰ä»…èƒ½é€šè¿‡è·Ÿè¸ªäº‹ä»¶è·å–ã€‚æŸ¥çœ‹ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/flutter/flutter/blob/master/packages/flutter_driver/lib/src/driver/profiling_summarizer.dart">profiling_summarizer.dart</a> ã€‚</li><li>æŸ¥çœ‹ <code>simple_animation_perf_ios</code> æµ‹è¯•æ¡ˆä¾‹ä¸­çš„ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://flutter-flutter-perf.skia.org/e/?queries=sub_result%3Daverage_cpu_usage%26sub_result%3Daverage_gpu_usage%26test%3Dsimple_animation_perf_ios">CPU/GPU æ•°æ®</a>ã€‚</li></ul></li><li>release_size_bytes å¯¹ Flutter åº”ç”¨ç¨‹åºçš„å¤§å°è¿›è¡Œä¼°ç®—<ul><li>æŸ¥çœ‹ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/flutter/flutter/blob/master/dev/devicelab/bin/tasks/basic_material_app_android__compile.dart">basic_material_app_android</a>ã€<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/flutter/flutter/blob/master/dev/devicelab/bin/tasks/basic_material_app_ios__compile.dart">basic_material_app_ios</a>ã€<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/flutter/flutter/blob/master/dev/devicelab/bin/tasks/hello_world_android__compile.dart">hello_world_android</a>ã€<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/flutter/flutter/blob/master/dev/devicelab/bin/tasks/hello_world_ios__compile.dart">hello_world_ios</a>ã€<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/flutter/flutter/blob/master/dev/devicelab/bin/tasks/flutter_gallery_android__compile.dart">flutter_gallery_android</a> å’Œ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/flutter/flutter/blob/master/dev/devicelab/bin/tasks/flutter_gallery_ios__compile.dart">flutter_gallery_ios</a> æµ‹è¯•æ¡ˆä¾‹ã€‚</li><li>æŸ¥çœ‹æ•°æ®çœ‹æ¿ä¸­çš„ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://flutter-flutter-perf.skia.org/e/?queries=sub_result%3Drelease_size_bytes%26test%3Dbasic_material_app_android__compile%26test%3Dbasic_material_app_ios__compile%26test%3Dhello_world_android__compile%26test%3Dhello_world_ios__compile%26test%3Dflutter_gallery_ios__compile%26test%3Dflutter_gallery_android__compile">ä½“ç§¯å¤§å°</a> æ•°æ®ã€‚</li><li>æœ‰å…³å¦‚ä½•æ›´ç²¾ç¡®çš„æµ‹é‡åº”ç”¨ä½“ç§¯ä¿¡æ¯ï¼ŒæŸ¥çœ‹ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://flutter.cn/docs/perf/app-size">åº”ç”¨ä½“ç§¯</a> é¡µé¢ã€‚</li></ul></li></ul><p>Â </p><h2 id="å¸ƒå±€åŠ è½½ä¼˜åŒ–">å¸ƒå±€åŠ è½½ä¼˜åŒ–</h2><blockquote><p>Flutter ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å£°æ˜ä¹¦ UI çš„ç¼–å†™æ–¹å¼ï¼Ÿ</p></blockquote><p>ä¸ºäº†å‡è½»å¼€å‘äººå‘˜çš„è´Ÿæ‹…ï¼Œæ— éœ€ç¼–å†™å¦‚ä½•åœ¨ä¸åŒçš„ UI çŠ¶æ€ä¹‹é—´è¿›è¡Œåˆ‡æ¢çš„ä»£ç ï¼ŒFlutter ä½¿ç”¨äº†å£°æ˜å¼çš„ UI ç¼–å†™æ–¹å¼ï¼Œè€Œä¸æ˜¯ Android å’Œ iOS ä¸­çš„å‘½ä»¤å¼ç¼–å†™æ–¹å¼ã€‚</p><p>è¿™æ ·çš„è¯ï¼Œ<strong>å½“ç”¨æˆ·ç•Œé¢å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒFlutter ä¸ä¼šä¿®æ”¹æ—§çš„ Widget å®ä¾‹ï¼Œè€Œæ˜¯ä¼šæ„é€ æ–°çš„ Widget å®ä¾‹</strong>ã€‚</p><p>Fluuter æ¡†æ¶ä½¿ç”¨ RenderObjects ç®¡ç†ä¼ ç»Ÿ UI å¯¹è±¡çš„èŒè´£ï¼ˆæ¯”å¦‚ç»´æŠ¤å¸ƒå±€çš„çŠ¶æ€ï¼‰ã€‚ RenderObjects åœ¨å¸§ä¹‹é—´ä¿æŒä¸å˜ï¼Œ Flutter çš„è½»é‡çº§ Widget é€šçŸ¥æ¡†æ¶åœ¨çŠ¶æ€ä¹‹é—´ä¿®æ”¹ RenderObjectsï¼Œ è€Œ Flutter Framework åˆ™è´Ÿè´£å¤„ç†å…¶ä½™éƒ¨åˆ†ã€‚</p><h3 id="å¸¸è§„ä¼˜åŒ–">å¸¸è§„ä¼˜åŒ–</h3><p>å¸¸è§„ä¼˜åŒ–å³é’ˆå¯¹ build() è¿›è¡Œä¼˜åŒ–ï¼Œbuild() æ–¹æ³•ä¸­çš„æ€§èƒ½é—®é¢˜ä¸€èˆ¬æœ‰ä¸¤ç§ï¼š<strong>è€—æ—¶æ“ä½œå’Œ Widget å †å </strong>ã€‚</p><h4 id="åœ¨-build-æ–¹æ³•ä¸­æ‰§è¡Œäº†è€—æ—¶æ“ä½œ">åœ¨ build() æ–¹æ³•ä¸­æ‰§è¡Œäº†è€—æ—¶æ“ä½œ</h4><p>æˆ‘ä»¬åº”è¯¥å°½é‡é¿å…åœ¨ build() ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œå› ä¸º build() ä¼šè¢«é¢‘ç¹åœ°è°ƒç”¨ï¼Œå°¤å…¶æ˜¯å½“ Widget é‡å»ºçš„æ—¶å€™ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬ä¸è¦åœ¨ä»£ç ä¸­è¿›è¡Œé˜»å¡å¼æ“ä½œï¼Œå¯ä»¥å°†æ–‡ä»¶è¯»å–ã€æ•°æ®åº“æ“ä½œã€ç½‘ç»œè¯·æ±‚ç­‰é€šè¿‡ Future æ¥è½¬æ¢æˆå¼‚æ­¥æ–¹å¼æ¥å®Œæˆã€‚</p><p>æœ€åï¼Œå¯¹äº CPU è®¡ç®—é¢‘ç¹çš„æ“ä½œï¼Œä¾‹å¦‚å›¾ç‰‡å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨ isolate æ¥å……åˆ†åˆ©ç”¨å¤šæ ¸å¿ƒ CPUã€‚</p><p><strong>isolate ä½œä¸º Flutter ä¸­çš„å¤šçº¿ç¨‹å®ç°æ–¹å¼ï¼Œä¹‹æ‰€ä»¥è¢«ç§°ä¹‹ä¸º isolateï¼ˆéš”ç¦»ï¼‰ï¼Œæ˜¯å› ä¸ºæ¯ä¸€ä¸ª isolate éƒ½æœ‰ä¸€ä»½å•ç‹¬çš„å†…å­˜</strong>ã€‚</p><p><strong>Flutter ä¼šè¿è¡Œä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œå®ƒä¼šä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å¾—æœ€æ—§çš„äº‹ä»¶ï¼Œå¤„ç†å®ƒï¼Œç„¶åå†è¿”å›ä¸‹ä¸€ä¸ªäº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°äº‹ä»¶é˜Ÿåˆ—æ¸…ç©ºä¸ºæ­¢ã€‚æ¯å½“åŠ¨ä½œä¸­æ–­æ—¶ï¼Œçº¿ç¨‹å°±ä¼šç­‰å¾…ä¸‹ä¸€ä¸ªäº‹ä»¶</strong>ã€‚</p><p>å®è´¨ä¸Šï¼Œä¸ä»…ä»…æ˜¯ isolateï¼Œæ‰€æœ‰çš„é«˜çº§ API éƒ½èƒ½å¤Ÿåº”ç”¨äºå¼‚æ­¥ç¼–ç¨‹ï¼Œä¾‹å¦‚ Futuresã€Streamsã€async å’Œ awaitï¼Œå®ƒä»¬å…¨éƒ¨éƒ½æ˜¯æ„å»ºåœ¨è¿™ä¸ªç®€å•çš„äº‹ä»¶å¾ªç¯ä¹‹ä¸Šã€‚</p><p>è€Œï¼Œ<strong>async å’Œ await å®é™…ä¸Šåªæ˜¯ä½¿ç”¨ futures å’Œ streams çš„æ›¿ä»£è¯­æ³•</strong>ï¼Œå®ƒå°†ä»£ç ç¼–å†™å½¢å¼ä»å¼‚æ­¥å˜ä¸ºåŒæ­¥ï¼Œä¸»è¦ç”¨æ¥å¸®åŠ©ä½ ç¼–å†™æ›´æ¸…æ™°ã€ç®€æ´çš„ä»£ç ã€‚</p><p>æ­¤å¤–ï¼Œasync å’Œ await ä¹Ÿèƒ½ä½¿ç”¨ try on catch finally æ¥è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œè¿™èƒ½å¤Ÿå¸®åŠ©ä½ å¤„ç†ä¸€äº›æ•°æ®è§£ææ–¹é¢çš„å¼‚å¸¸ã€‚</p><h4 id="ä½¿ç”¨-Widget-è€Œä¸æ˜¯å‡½æ•°">ä½¿ç”¨ Widget è€Œä¸æ˜¯å‡½æ•°</h4><p>å¦‚æœä¸€ä¸ªå‡½æ•°å¯ä»¥åšåŒæ ·çš„äº‹æƒ…ï¼ŒFlutter å°±ä¸ä¼šæœ‰ StatelessWidget ï¼Œä½¿ç”¨ StatelessWidget çš„æœ€å¤§å¥½å¤„åœ¨äºï¼šèƒ½å°½é‡é¿å…ä¸å¿…è¦çš„é‡å»ºã€‚æ€»çš„æ¥è¯´ï¼Œå®ƒçš„ä¼˜åŠ¿æœ‰ï¼š</p><ul><li>1ï¼‰ã€å…è®¸æ€§èƒ½ä¼˜åŒ–ï¼šconst æ„é€ å‡½æ•°ï¼Œæ›´ç»†ç²’åº¦çš„é‡å»ºç­‰ç­‰ã€‚</li><li>2ï¼‰ã€ç¡®ä¿åœ¨ä¸¤ä¸ªä¸åŒçš„å¸ƒå±€ä¹‹é—´åˆ‡æ¢æ—¶ï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†èµ„æºï¼ˆå› ä¸ºå‡½æ•°å¯èƒ½é‡ç”¨æŸäº›å…ˆå‰çš„çŠ¶æ€ï¼‰ã€‚</li><li>3ï¼‰ã€ç¡®ä¿çƒ­é‡è½½æ­£å¸¸å·¥ä½œï¼Œä½¿ç”¨å‡½æ•°å¯èƒ½ä¼šç ´åçƒ­é‡è½½ã€‚</li><li>4ï¼‰ã€åœ¨ flutter è‡ªå¸¦çš„ Widget æ˜¾ç¤ºå·¥å…·ä¸­èƒ½çœ‹åˆ° Widget çš„çŠ¶æ€å’Œå‚æ•°ã€‚</li><li>5ï¼‰ã€å‘ç”Ÿé”™è¯¯æ—¶ï¼Œæœ‰æ›´æ¸…æ™°çš„æç¤ºï¼šæ­¤æ—¶ï¼ŒFlutter æ¡†æ¶å°†ä¸ºä½ æä¾›å½“å‰æ„å»ºçš„ Widget åç§°ï¼Œæ›´å®¹æ˜“æ’æŸ¥é—®é¢˜ã€‚</li><li>6ï¼‰ã€å¯ä»¥å®šä¹‰ key å’Œæ–¹ä¾¿ä½¿ç”¨ context çš„ APIã€‚</li></ul><h4 id="ä½¿ç”¨-nil-å»æ›¿ä»£-Container-å’Œ-SizedBox">ä½¿ç”¨ nil å»æ›¿ä»£ Container() å’Œ SizedBox()</h4><p>é¦–å…ˆï¼Œä½ éœ€è¦æ˜ç™½ <strong>nil ä»…ä»…æ˜¯ä¸€ä¸ªåŸºç¡€çš„ Widget å…ƒç´  ï¼Œå®ƒçš„æ„å»ºæˆæœ¬å‡ ä¹æ²¡æœ‰ã€‚</strong></p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœä½ ä¸æƒ³æ˜¾ç¤ºä»»ä½•å†…å®¹ï¼Œä¸”ä¸èƒ½è¿”å› null çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šè¿”å›ç±»ä¼¼ const SizedBox/Container çš„ Widgetï¼Œä½†æ˜¯ SizedBox ä¼šåˆ›å»º RenderObjectï¼Œè€Œæ¸²æŸ“æ ‘ä¸­çš„ RenderObject ä¼šå¸¦æ¥å¤šä½™çš„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶å’Œé¢å¤–çš„è®¡ç®—æ¶ˆè€—ï¼Œå³ä¾¿ä½ æ²¡æœ‰ç»™ SizedBox æŒ‡å®šä»»ä½•çš„å‚æ•°ã€‚</p><p>ä¸‹é¢ï¼Œæ˜¯æˆ‘å¹³æ—¶ä½¿ç”¨ nil çš„ä¸€å¥—æ–¹å¼ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BEST</span></span><br><span class="line">text != <span class="keyword">null</span> ? Text(text) : nil</span><br><span class="line">or</span><br><span class="line"><span class="keyword">if</span> (text != <span class="keyword">null</span>) Text(text)</span><br><span class="line">text != <span class="keyword">null</span> ? Text(text) : <span class="keyword">const</span> Container()/SizedBox()</span><br></pre></td></tr></table></figure><h3 id="åˆ—è¡¨ä¼˜åŒ–">åˆ—è¡¨ä¼˜åŒ–</h3><p>åœ¨æ„å»ºå¤§å‹ç½‘æ ¼æˆ–åˆ—è¡¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å°½é‡é¿å…ä½¿ç”¨ <code>ListView(children: [],)</code> æˆ– <code>GridView(children: [],)</code>ï¼Œå› ä¸ºï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä¸ç®¡åˆ—è¡¨å†…å®¹æ˜¯å¦å¯è§ï¼Œä¼šå¯¼è‡´åˆ—è¡¨ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šè¢«ä¸€æ¬¡æ€§ç»˜åˆ¶å‡ºæ¥ï¼Œè¿™ç§ç”¨æ³•ç±»ä¼¼äº Android çš„ ScrollViewã€‚</p><p>å¦‚æœæˆ‘ä»¬åˆ—è¡¨æ•°æ®æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œå»ºè®®ä½¿ç”¨ ListView å’Œ GridView çš„ builder æ–¹æ³•ï¼Œå®ƒä»¬åªä¼šç»˜åˆ¶å¯è§çš„åˆ—è¡¨å†…å®¹ï¼Œç±»ä¼¼äº Android çš„ RecyclerViewã€‚</p><p>å…¶å®ï¼Œæœ¬è´¨ä¸Šï¼Œ<strong>å°±æ˜¯å¯¹åˆ—è¡¨é‡‡ç”¨äº†æ‡’åŠ è½½è€Œä¸æ˜¯ç›´æ¥ä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰çš„å­ Widgetï¼Œè¿™æ ·è§†å›¾çš„åˆå§‹åŒ–æ—¶é—´å°±å‡å°‘äº†</strong>ã€‚</p><h4 id="é’ˆå¯¹äºé•¿åˆ—è¡¨ï¼Œè®°å¾—åœ¨-ListView-ä¸­ä½¿ç”¨-itemExtentã€‚">é’ˆå¯¹äºé•¿åˆ—è¡¨ï¼Œè®°å¾—åœ¨ ListView ä¸­ä½¿ç”¨ itemExtentã€‚</h4><p>æœ‰æ—¶å€™å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆé•¿çš„åˆ—è¡¨ï¼Œæƒ³è¦ç”¨æ»šåŠ¨æ¡æ¥å¤§è·³æ—¶ï¼Œä½¿ç”¨ itemExtent å°±å¾ˆé‡è¦äº†ï¼Œ<strong>å®ƒä¼šå¸®åŠ© Flutter å»è®¡ç®— ListView çš„æ»šåŠ¨ä½ç½®è€Œä¸æ˜¯è®¡ç®—æ¯ä¸€ä¸ª Widget çš„é«˜åº¦ï¼Œä¸æ­¤åŒæ—¶ï¼Œå®ƒèƒ½å¤Ÿä½¿æ»šåŠ¨åŠ¨ç”»æœ‰æ›´å¥½çš„æ€§èƒ½</strong>ã€‚</p><h4 id="å‡å°‘å¯æŠ˜å -ListView-çš„æ„å»ºæ—¶é—´">å‡å°‘å¯æŠ˜å  ListView çš„æ„å»ºæ—¶é—´</h4><p><strong>é’ˆå¯¹äºå¯æŠ˜å çš„ ListViewï¼Œæœªå±•å¼€çŠ¶æ€æ—¶ï¼Œè®¾ç½®å…¶ itemCount ä¸º 0ï¼Œè¿™æ · item åªä¼šåœ¨å±•å¼€çŠ¶æ€ä¸‹æ‰è¿›è¡Œæ„å»ºï¼Œä»¥å‡å°‘é¡µé¢ç¬¬ä¸€æ¬¡çš„æ‰“å¼€æ„å»ºæ—¶é—´</strong>ã€‚</p><p>Â </p><h3 id="æ·±å…¥ä¼˜åŒ–">æ·±å…¥ä¼˜åŒ–</h3><h4 id="ä¼˜åŒ–å…‰æ …çº¿ç¨‹">ä¼˜åŒ–å…‰æ …çº¿ç¨‹</h4><p>æ‰€æœ‰çš„ Flutter åº”ç”¨è‡³å°‘éƒ½ä¼šè¿è¡Œåœ¨ä¸¤ä¸ªå¹¶è¡Œçš„çº¿ç¨‹ä¸Šï¼š<strong>UI çº¿ç¨‹å’Œ Raster çº¿ç¨‹</strong>ã€‚</p><p>**UI çº¿ç¨‹æ˜¯ä½ æ„å»º Widgets å’Œè¿è¡Œåº”ç”¨é€»è¾‘çš„åœ°æ–¹ã€‚ ** <strong>Raster çº¿ç¨‹æ˜¯ Flutter ç”¨æ¥æ …æ ¼åŒ–ä½ çš„åº”ç”¨çš„ã€‚å®ƒä» UI çº¿ç¨‹è·å–æŒ‡ä»¤å¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºå¯ä»¥å‘é€åˆ°å›¾å½¢å¡çš„å†…å®¹ã€‚</strong></p><p><strong>åœ¨å…‰æ …çº¿ç¨‹ä¸­ï¼Œä¼šè·å–å›¾ç‰‡çš„å­—èŠ‚ï¼Œè°ƒæ•´å›¾åƒçš„å¤§å°ï¼Œåº”ç”¨é€æ˜åº¦ã€æ··åˆæ¨¡å¼ã€æ¨¡ç³Šç­‰ç­‰ï¼Œç›´åˆ°äº§ç”Ÿæœ€åçš„å›¾å½¢åƒç´ ã€‚ç„¶åï¼Œå…‰æ …çº¿ç¨‹ä¼šå°†å…¶å‘é€åˆ°å›¾å½¢å¡ï¼Œç»§è€Œå‘é€åˆ°å±å¹•ä¸Šæ˜¾ç¤ºã€‚</strong></p><p>ä½¿ç”¨ Flutter DevTools-Performance è¿›è¡Œæ£€æµ‹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>1ã€åœ¨ Performance Overlay ä¸­ï¼ŒæŸ¥çœ‹å…‰æ …çº¿ç¨‹å’Œ UI çº¿ç¨‹å“ªä¸ªè´Ÿè½½è¿‡é‡ã€‚</li><li>2ã€åœ¨ Timeline Events ä¸­ï¼Œæ‰¾åˆ°é‚£äº›è€—è´¹æ—¶é—´æœ€é•¿çš„äº‹ä»¶ï¼Œä¾‹å¦‚å¸¸è§çš„ SkCanvas::Flushï¼Œå®ƒè´Ÿè´£è§£å†³æ‰€æœ‰å¾…å¤„ç†çš„ GPU æ“ä½œã€‚</li><li>3ã€æ‰¾åˆ°å¯¹åº”çš„ä»£ç åŒºåŸŸï¼Œé€šè¿‡åˆ é™¤ Widgets æˆ–æ–¹æ³•çš„æ–¹å¼æ¥çœ‹å¯¹æ€§èƒ½çš„å½±å“ã€‚</li></ul><h4 id="ç”¨-key-åŠ é€Ÿ-Flutter-çš„æ€§èƒ½ä¼˜åŒ–å…‰æ …çº¿ç¨‹">ç”¨ key åŠ é€Ÿ Flutter çš„æ€§èƒ½ä¼˜åŒ–å…‰æ …çº¿ç¨‹</h4><p>ä¸€ä¸ª element æ˜¯ç”± Widget å†…éƒ¨åˆ›å»ºçš„ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯ï¼Œ<strong>çŸ¥é“å¯¹åº”çš„ Widget åœ¨ Widget æ ‘ä¸­æ‰€å¤„çš„ä½ç½®ã€‚ä½†æ˜¯å…ƒç´ çš„åˆ›å»ºæ˜¯éå¸¸æ˜‚è´µçš„ï¼Œé€šè¿‡ Keysï¼ˆValueKeys å’Œ GlobalKeysï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å»é‡å¤ä½¿ç”¨å®ƒä»¬ã€‚</strong></p><blockquote><p>GlobalKey ä¸ ValueKey çš„åŒºåˆ«ï¼Ÿ</p></blockquote><p><strong>GlobalKey æ˜¯å…¨å±€ä½¿ç”¨çš„ keyï¼Œåœ¨è·¨å°éƒ¨ä»¶çš„åœºæ™¯æ—¶ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨å®ƒå»åˆ·æ–°å…¶å®ƒå°éƒ¨ä»¶ã€‚ä½†ï¼Œå®ƒæ˜¯å¾ˆæ˜‚è´µçš„ï¼Œå¦‚æœä½ ä¸éœ€è¦è®¿é—® BuildContextã€Element å’Œ Stateï¼Œåº”è¯¥å°½é‡ä½¿ç”¨ LocalKeyã€‚</strong></p><p>è€Œ ValueKey å’Œ ObjectKeyã€UniqueKey ä¸€æ ·éƒ½å½’å±äºå±€éƒ¨ä½¿ç”¨çš„ LocalKeyï¼Œæ— æ³•è·¨å®¹å™¨ä½¿ç”¨ï¼ŒValueKey æ¯”è¾ƒçš„æ˜¯ Widget çš„å€¼ï¼Œè€Œ ObjectKey æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„ keyï¼ŒUniqueKey åˆ™æ¯æ¬¡éƒ½ä¼šç”Ÿæˆä¸€ä¸ªä¸åŒçš„å€¼ã€‚</p><h5 id="å…ƒç´ çš„ç”Ÿå‘½å‘¨æœŸ">å…ƒç´ çš„ç”Ÿå‘½å‘¨æœŸ</h5><ul><li><strong>Mount</strong>ï¼šæŒ‚è½½ï¼Œå½“å…ƒç´ ç¬¬ä¸€æ¬¡è¢«æ·»åŠ åˆ°æ ‘ä¸Šçš„æ—¶å€™è°ƒç”¨ã€‚</li><li><strong>Active</strong>ï¼šå½“éœ€è¦æ¿€æ´»ä¹‹å‰å¤±æ´»çš„å…ƒç´ æ—¶è¢«è°ƒç”¨ã€‚</li><li><strong>Update</strong>ï¼šç”¨æ–°æ•°æ®å»æ›´æ–° RenderObjectã€‚</li><li><strong>Deactive</strong>ï¼šå½“å…ƒç´ ä» Widget æ ‘ä¸­è¢«ç§»é™¤æˆ–ç§»åŠ¨æ—¶è¢«è°ƒç”¨ã€‚å¦‚æœä¸€ä¸ªå…ƒç´ åœ¨åŒä¸€å¸§æœŸé—´è¢«ç§»åŠ¨äº†ä¸”å®ƒæœ‰ GlobalKeyï¼Œé‚£ä¹ˆå®ƒä»ç„¶èƒ½å¤Ÿè¢«æ¿€æ´»ã€‚</li><li><strong>UnMount</strong>ï¼šå¸è½½ï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ åœ¨ä¸€å¸§æœŸé—´æ²¡æœ‰è¢«æ¿€æ´»ï¼Œå®ƒå°†ä¼šè¢«å¸è½½ï¼Œå¹¶ä¸”å†ä¹Ÿä¸ä¼šè¢«å¤ç”¨ã€‚</li></ul><h5 id="ä¼˜åŒ–æ–¹å¼">ä¼˜åŒ–æ–¹å¼</h5><p>**ä¸ºäº†å»æ”¹å–„æ€§èƒ½ï¼Œä½ éœ€è¦å»å°½å¯èƒ½è®© Widget ä½¿ç”¨ Activie å’Œ Update æ“ä½œï¼Œå¹¶ä¸”å°½é‡é¿å…è®© Widgetè§¦å‘ UnMount å’Œ Mountã€‚**è€Œä½¿ç”¨ GlobayKeys å’Œ ValueKey åˆ™èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// <span class="language-markdown">1ã€ç»™ MaterialApp æŒ‡å®š GlobalKeys</span></span></span><br><span class="line">MaterialApp(key: global, home: child,);</span><br><span class="line"><span class="comment">/// <span class="language-markdown">2ã€é€šè¿‡æŠŠ ValueKey åˆ†é…åˆ°æ­£åœ¨è¢«å¸è½½çš„æ ¹ Widgetï¼Œä½ å°±èƒ½å¤Ÿ</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">å‡å°‘ Widget çš„å¹³å‡æ„å»ºæ—¶é—´ã€‚</span></span></span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">return</span> Column(</span><br><span class="line">    children: [</span><br><span class="line">      value</span><br><span class="line">          ? <span class="keyword">const</span> SizedBox(key: ValueKey(<span class="string">&#x27;SizedBox&#x27;</span>))</span><br><span class="line">          : <span class="keyword">const</span> Placeholder(key: ValueKey(<span class="string">&#x27;Placeholder&#x27;</span>)),</span><br><span class="line">      GestureDetector(</span><br><span class="line">        key: ValueKey(<span class="string">&#x27;GestureDetector&#x27;</span>),</span><br><span class="line">        onTap: () &#123;</span><br><span class="line">          setState(() &#123;</span><br><span class="line">            value = !value;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        child: Container(</span><br><span class="line">          width: <span class="number">100</span>,</span><br><span class="line">          height: <span class="number">100</span>,</span><br><span class="line">          color: Colors.red,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      !value</span><br><span class="line">          ? <span class="keyword">const</span> SizedBox(key: ValueKey(<span class="string">&#x27;SizedBox&#x27;</span>))</span><br><span class="line">          : <span class="keyword">const</span> Placeholder(key: ValueKey(<span class="string">&#x27;Placeholder&#x27;</span>)),</span><br><span class="line">    ],</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚ä½•çŸ¥é“å“ªäº› Widget ä¼šè¢« Updateï¼Œå“ªäº› Widgetä¼šè¢« UnMountï¼Ÿ</p></blockquote><p>åªæœ‰ build ç›´æ¥ return çš„é‚£ä¸ªæ ¹ Widget ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œå…¶å®ƒéƒ½æœ‰å¯èƒ½è¢« UnMountï¼Œå› æ­¤éƒ½éœ€è¦ç»™å…¶åˆ†é… ValueKeyã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆæ²¡æœ‰ç»™ Container åˆ†é… ValueKeyï¼Ÿ</p></blockquote><p>å› ä¸º Container æ˜¯ GestureDetector çš„ä¸€ä¸ªå­ Widgetï¼Œæ‰€ä»¥å½“ç»™ GestureDetector ä½¿ç”¨ ValueKey å»å®ç°å¤ç”¨æ›´æ–°æ—¶ï¼ŒContainer ä¹Ÿèƒ½è¢«è‡ªåŠ¨æ›´æ–°ã€‚</p><h5 id="ä¼˜åŠ¿">ä¼˜åŠ¿</h5><p>å¤§å¹…åº¦å‡å°‘ Widgetçš„å¹³å‡æ„å»ºæ—¶é—´ã€‚</p><h5 id="ç¼ºç‚¹-2">ç¼ºç‚¹</h5><ul><li><strong>è¿‡å¤šä½¿ç”¨ ValueKey ä¼šè®©ä½ çš„ä»£ç å˜å¾—æ›´å†—ä½™ã€‚</strong></li><li><strong>å¦‚æœä½ çš„æ ¹ Widget æ˜¯ MaterialApp æ—¶ï¼Œåˆ™éœ€è¦ä½¿ç”¨ GlobalKeyï¼Œä½†å½“ä½ å»é‡å¤ä½¿ç”¨ GlobalKey æ—¶å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é”™è¯¯ï¼Œæ‰€ä»¥ä¸€å®šè¦é¿å…æ»¥ç”¨ Keyã€‚</strong></li></ul><p>æ³¨æ„ğŸ“¢ï¼šåœ¨å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ï¼ŒFlutter çš„æ€§èƒ½éƒ½æ˜¯è¶³å¤Ÿçš„ï¼Œä¸éœ€è¦è¿™ä¹ˆç»†è‡´çš„ä¼˜åŒ–ï¼Œåªæœ‰å½“äº§ç”Ÿäº†è§†è§‰ä¸Šçš„é—®é¢˜ï¼Œä¾‹å¦‚å¡é¡¿æ—¶æ‰éœ€è¦å»åˆ†æä¼˜åŒ–ã€‚</p><p>Â </p><h2 id="é¢„ç¼–è¯‘Shader">é¢„ç¼–è¯‘Shader</h2><p>If the animations on your mobile app appear to be janky, but only on the first run, you can warm up the shader captured in the Skia Shader Language (SkSL) for a significant improvement.</p><p>å¦‚æœä½ çš„æ‰‹æœº Appä¸Šçš„åŠ¨ç”»çœ‹èµ·æ¥å¾ˆå¡é¡¿ï¼Œä½†åªæ˜¯åœ¨ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œä½ å¯ä»¥é¢„çƒ­åœ¨ Skia shadersè¯­è¨€ (SkSL) ä¸­æ•è·çš„shadersï¼Œä»¥æ­¤è·å¾—æ˜¾ç€çš„æ”¹è¿›ã€‚</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cfanz.cdn.bcebos.com/uploads/gif/2022/01/20/1/aeWa8NV443.gif" alt=""></p><h3 id="What-is-shader-compilation-jank-ä»€ä¹ˆæ˜¯shadersç¼–è¯‘å¡é¡¿ï¼Ÿ">What is shader compilation jank? -ä»€ä¹ˆæ˜¯shadersç¼–è¯‘å¡é¡¿ï¼Ÿ</h3><p>If an app has janky animations during the first run, and later becomes smooth for the same animation, then itâ€™s very likely due to shader compilation jank.</p><p>å¦‚æœä¸€ä¸ªAppåœ¨ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶å‡ºç°äº†animationå¡é¡¿ï¼Œåæ¥ç›¸åŒçš„animationå´å˜å¾—æµç•…ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½æ˜¯shadersç¼–è¯‘ å¯¼è‡´çš„å¡é¡¿ã€‚</p><p>More technically, a shader is a piece of code that runs on a GPU (graphics processing unit). When a shader is first used, it needs to be compiled on the device. The compilation could cost up to a few hundred milliseconds whereas a smooth frame needs to be drawn within 16 milliseconds for a 60 fps (frame-per-second) display.</p><p>ä»æŠ€æœ¯ä¸Šè®²ï¼Œshadersæ˜¯åœ¨ GPUï¼ˆå›¾å½¢å¤„ç†å•å…ƒï¼‰ä¸Šè¿è¡Œçš„ä¸€æ®µä»£ç ã€‚ é¦–æ¬¡ä½¿ç”¨shadersæ—¶ï¼Œéœ€è¦åœ¨è®¾å¤‡ä¸Šå¯¹å…¶è¿›è¡Œç¼–è¯‘ã€‚ ç¼–è¯‘å¯èƒ½ä¼šèŠ±è´¹æ•°ç™¾æ¯«ç§’ï¼Œè€Œæµç•…çš„æ˜¾ç¤ºå¸§éœ€è¦åœ¨ 16 æ¯«ç§’å†…ç»˜åˆ¶ï¼Œæ‰èƒ½å®ç° 60 fpsï¼ˆæ¯ç§’å¸§æ•°ï¼‰çš„æ˜¾ç¤ºã€‚</p><p>Therefore, a compilation could cause tens of frames to be missed, and drop the fps from 60 to 6. This is compilation jank. After the compilation is complete, the animation should be smooth.</p><p>å› æ­¤ï¼Œä¸€æ¬¡ç¼–è¯‘å¯èƒ½ä¼šå¯¼è‡´æ•°åå¸§ä¸¢å¤±ï¼Œå¹¶å°† fps ä» 60 é™è‡³ 6ã€‚è¿™å°±æ˜¯ç¼–è¯‘å¡é¡¿ã€‚ åœ¨ç¼–è¯‘å®Œæˆåï¼Œanimationåº”è¯¥æ˜¯æµç•…è¿è¡Œçš„ã€‚</p><p>Definitive evidence for the presence of shader compilation jank is to see GrGLProgramBuilder::finalize in the tracing with --trace-skia enabled. See the following screenshot for an example timeline tracing.</p><p>å­˜åœ¨shadersç¼–è¯‘å¡é¡¿çš„æ˜ç¡®ç°è±¡æ˜¯åœ¨å¯ç”¨äº† --trace-skia çš„è·Ÿè¸ªä¸­çœ‹åˆ° GrGLProgramBuilder::finalizeã€‚ æœ‰å…³æ—¶é—´çº¿è·Ÿè¸ªçš„ç¤ºä¾‹ï¼Œè¯·å‚è§ä¸‹é¢çš„å±å¹•æˆªå›¾ã€‚</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cfanz.cdn.bcebos.com/uploads/png/2022/01/20/1/Q39H4HbcKG.png" alt=""></p><h3 id="What-do-we-mean-by-â€œfirst-runâ€-æˆ‘ä»¬æ‰€è¯´çš„â€œç¬¬ä¸€æ¬¡è¿è¡Œâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ">What do we mean by â€œfirst runâ€? - æˆ‘ä»¬æ‰€è¯´çš„â€œç¬¬ä¸€æ¬¡è¿è¡Œâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h3><p>On Android, â€œfirst runâ€ means that the user might see jank the first time opening the app after a fresh installation. Subsequent runs should be fine.</p><p>åœ¨ Android ä¸Šï¼Œâ€œé¦–æ¬¡è¿è¡Œâ€æ„å‘³ç€ç”¨æˆ·åœ¨å…¨æ–°å®‰è£…åç¬¬ä¸€æ¬¡æ‰“å¼€Appæ—¶å¯èƒ½ä¼šçœ‹åˆ°å¡é¡¿ã€‚ åç»­è¿è¡Œå°±æ²¡é—®é¢˜ã€‚</p><p>On iOS, â€œfirst runâ€ means that the user might see jank when an animation first occurs every time the user opens the app from scratch.</p><p>åœ¨ iOS ä¸Šï¼Œâ€œé¦–æ¬¡è¿è¡Œâ€æ„å‘³ç€ç”¨æˆ·å¯èƒ½ä¼šåœ¨æ¯æ¬¡ç”¨æˆ·ä»å¤´å¼€å§‹æ‰“å¼€Appæ—¶ç¬¬ä¸€æ¬¡å‡ºç°åŠ¨ç”»æ—¶çœ‹åˆ°å¡é¡¿ã€‚</p><h3 id="How-to-use-SkSL-warmup-å¦‚ä½•ä½¿ç”¨-SkSL-çƒ­èº«">How to use SkSL warmup - å¦‚ä½•ä½¿ç”¨ SkSL çƒ­èº«</h3><p>As of release 1.20, Flutter provides command line tools for app developers to collect shaders that might be needed for end-users in the SkSL (Skia Shader Language) format. The SkSL shaders can then be packaged into the app, and get warmed up (pre-compiled) when an end-user first opens the app, thereby reducing the compilation jank in later animations. Use the following instructions to collect and package the SkSL shaders:</p><p>ä» 1.20 ç‰ˆå¼€å§‹ï¼ŒFlutter ä¸ºAppå¼€å‘äººå‘˜æä¾›å‘½ä»¤è¡Œå·¥å…·ï¼Œä»¥æ”¶é›†æœ€ç»ˆç”¨æˆ·å¯èƒ½éœ€è¦çš„ SkSLï¼ˆSkia shadersè¯­è¨€ï¼‰æ ¼å¼çš„shadersã€‚SkSL shaderså¯ä»¥æ‰“åŒ…åˆ°Appä¸­ï¼Œå¹¶åœ¨æœ€ç»ˆç”¨æˆ·é¦–æ¬¡æ‰“å¼€Appæ—¶è¿›è¡Œé¢„çƒ­ï¼ˆé¢„ç¼–è¯‘ï¼‰ï¼Œä»è€Œå‡å°‘åç»­animationçš„ç¼–è¯‘å¡é¡¿ã€‚ ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ”¶é›†å’Œæ‰“åŒ… SkSL shadersï¼š</p><p>1.Run the app with --cache-sksl turned on to capture shaders in SkSL:</p><p>1.è¿è¡ŒAppå¸¦ä¸Š --cache-sksl å‚æ•°ï¼Œä»¥ä¾¿åœ¨ SkSL ä¸­æ•è·shadersï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter run --profile --cache-sksl</span><br></pre></td></tr></table></figure><p>If the same app has been previously run without --cache-sksl, then the --purge-persistent-cache flag may be needed:</p><p>å¦‚æœä¹‹å‰åœ¨æ²¡æœ‰ --cache-sksl çš„æƒ…å†µä¸‹è¿è¡Œç›¸åŒçš„Appï¼Œåˆ™å¯èƒ½éœ€è¦ --purge-persistent-cache æ ‡å¿—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter run --profile --cache-sksl --purge-persistent-cache</span><br></pre></td></tr></table></figure><p>This flag removes older non-SkSL shader caches that could interfere with SkSL shader capturing. It also purges the SkSL shaders so use it only on the first --cache-sksl run.</p><p>æ­¤æ ‡å¿—ä¼šæ¶ˆé™¤ â€è¾ƒæ—§çš„é SkSL shadersç¼“å­˜â€œ å¯¹ â€SkSL shadersæ•è·â€œçš„å¹²æ‰°ã€‚ å®ƒè¿˜ä¼šæ¸…é™¤ SkSL shadersï¼Œæ‰€ä»¥åªåœ¨ç¬¬ä¸€æ¬¡è¿è¡Œ --cache-sksl æ—¶ä½¿ç”¨å®ƒã€‚</p><p>2.Play with the app to trigger as many animations as needed; particularly those with compilation jank.</p><p>2.è¿è¡ŒAppä»¥æ ¹æ®éœ€è¦è§¦å‘å°½å¯èƒ½å¤šçš„animationï¼› ç‰¹åˆ«æ˜¯é‚£äº›æœ‰ç¼–è¯‘å¡é¡¿çš„ã€‚</p><p>3.Press M at the command line of flutter run to write the captured SkSL shaders into a file named something like flutter_01.sksl.json. For best results, capture SkSL shaders on actual Android and iOS devices separately.</p><p>3.åœ¨ flutter run çš„å‘½ä»¤è¡ŒæŒ‰ M ï¼ˆ<strong>æˆ‘çš„æ˜¯Alt+M</strong>ï¼‰å°†æ•è·çš„ SkSL shaderså†™å…¥åä¸º flutter_01.sksl.json çš„æ–‡ä»¶ä¸­ã€‚ ä¸ºäº†è·å–åˆ°æœ€ä½³æ•ˆæœï¼Œè¯·åˆ†åˆ«åœ¨çœŸå®çš„ Android å’Œ iOS æ‰‹æœºä¸Šæ•è· SkSL shadersã€‚</p><p>Build the app with SkSL warm-up using the following, as appropriate:</p><p>é€‚å½“çš„é€šè¿‡ä»¥ä¸‹æ–¹æ³• è®© ç¼–è¯‘çš„ Appå¸¦ä¸Š â€SkSL é¢„çƒ­â€œï¼š</p><p>Android:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter build apk --bundle-sksl-path flutter_01.sksl.json</span><br></pre></td></tr></table></figure><p>or æˆ–è€…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter build appbundle --bundle-sksl-path flutter_01.sksl.json</span><br></pre></td></tr></table></figure><p>iOS:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter build ios --bundle-sksl-path flutter_01.sksl.json</span><br></pre></td></tr></table></figure><p>If itâ€™s built for a driver test like test_driver/app.dart, make sure to also specify --target=test_driver/app.dart (e.g., flutter build ios --bundle-sksl-path flutter_01.sksl.json --target=test_driver/app.dart).</p><p>å¦‚æœå®ƒæ˜¯ä¸ºåƒ test_driver/app.dart è¿™æ ·çš„é©±åŠ¨ç¨‹åºæµ‹è¯•è€Œæ„å»ºçš„ï¼Œè¯·ç¡®ä¿è¿˜æŒ‡å®š --target=test_driver/app.dart ï¼ˆä¾‹å¦‚ï¼Œflutter build ios --bundle-sksl-path flutter_01.sksl.json --target= test_driver/app.dartï¼‰ã€‚</p><p>5.Test the newly built app.</p><p>5.æµ‹è¯•æ–°å»ºçš„Appã€‚</p><p>Alternatively, you can write some integration tests to automate the first three steps using a single command. For example:</p><p>æˆ–è€…ï¼Œä½ å¯ä»¥ç¼–å†™ä¸€äº›é›†æˆæµ‹è¯•ä»¥ä½¿ç”¨å•ä¸ªå‘½ä»¤è‡ªåŠ¨æ‰§è¡Œå‰ä¸‰ä¸ªæ­¥éª¤ã€‚ ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter drive --profile --cache-sksl --write-sksl-on-exit flutter_01.sksl.json -t test_driver/app.dart</span><br></pre></td></tr></table></figure><p>With such integration tests, you can easily and reliably get the new SkSLs when the app code changes, or when Flutter upgrades. Such tests can also be used to verify the performance change before and after the SkSL warm-up. Even better, you can put those tests into a CI (continuous integration) system so the SkSLs are generated and tested automatically over the lifetime of an app.</p><p>é€šè¿‡æ­¤ç±»é›†æˆæµ‹è¯•ï¼Œä½ å¯ä»¥åœ¨appä»£ç æ›´æ”¹æˆ– Flutter å‡çº§æ—¶è½»æ¾å¯é åœ°è·å–æ–°çš„ SkSLã€‚ æ­¤ç±»æµ‹è¯•è¿˜å¯ç”¨äºéªŒè¯ SkSL é¢„çƒ­å‰åçš„æ€§èƒ½å˜åŒ–ã€‚ æ›´å¥½çš„æ˜¯ï¼Œä½ å¯ä»¥å°†è¿™äº›æµ‹è¯•æ”¾å…¥ CIï¼ˆæŒç»­é›†æˆï¼‰ç³»ç»Ÿä¸­ï¼Œä»¥ä¾¿åœ¨Appçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…è‡ªåŠ¨ç”Ÿæˆå’Œæµ‹è¯• SkSLã€‚</p><p>Take the original version of Flutter Gallery as an example. The CI system is set up to generate SkSLs for every Flutter commit, and verifies the performance, in the transitions_perf_test.dart test. For more details, see the flutter_gallery_sksl_warmup__transition_perf and flutter_gallery_sksl_warmup__transition_perf_e2e_ios32 tasks.</p><p>ä»¥åŸç‰ˆ Flutter Gallery ä¸ºä¾‹ã€‚ CI ç³»ç»Ÿè®¾ç½®ä¸ºä¸ºæ¯æ¬¡ Flutter æäº¤ç”Ÿæˆ SkSLï¼Œå¹¶åœ¨ transitions_perf_test.dart æµ‹è¯•ä¸­éªŒè¯æ€§èƒ½ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… flutter_gallery_sksl_warmup__transition_perf å’Œflutter_gallery_sksl_warmup__transition_perf_e2e_ios32 ä»»åŠ¡ã€‚</p><p>The worst frame rasterization time is a nice metric from such integration tests to indicate the severity of shader compilation jank. For instance, the steps above reduce Flutter galleryâ€™s shader compilation jank and speeds up its worst frame rasterization time on a Moto G4 from ~90 ms to ~40 ms. On iPhone 4s, itâ€™s reduced from ~300 ms to ~80 ms. That leads to the visual difference as illustrated in the beginning of this article.</p><p>æœ€å·®å¸§rasteræ—¶é—´æ˜¯æ­¤ç±»é›†æˆæµ‹è¯•çš„ä¸€ä¸ªå¾ˆå¥½çš„æŒ‡æ ‡ï¼Œç”¨äºæŒ‡ç¤ºshadersç¼–è¯‘å¡é¡¿çš„ä¸¥é‡æ€§ã€‚ ä¾‹å¦‚ï¼Œä¸Šè¿°æ­¥éª¤å‡å°‘äº† Flutter åº“çš„shadersç¼–è¯‘å¡é¡¿ï¼Œå¹¶å°†å…¶åœ¨ Moto G4 ä¸Šçš„æœ€å·®rasteræ—¶é—´ä» ~90 ms åŠ é€Ÿåˆ° ~40 msã€‚ åœ¨ iPhone 4s ä¸Šï¼Œå®ƒä» ~300 ms å‡å°‘åˆ° ~80 msã€‚ è¿™å¯¼è‡´äº†æœ¬æ–‡å¼€å¤´æ‰€ç¤ºçš„è§†è§‰å·®å¼‚ã€‚</p><h3 id="Frequently-asked-questions-å¸¸é—®çš„é—®é¢˜">Frequently asked questions- å¸¸é—®çš„é—®é¢˜</h3><h4 id="Why-not-just-compile-or-warm-up-all-possible-shaders-ä¸ºä»€ä¹ˆä¸ç›´æ¥ç¼–è¯‘æˆ–é¢„çƒ­æ‰€æœ‰å¯èƒ½çš„shadersï¼Ÿ">Why not just compile or warm up all possible shaders? - ä¸ºä»€ä¹ˆä¸ç›´æ¥ç¼–è¯‘æˆ–é¢„çƒ­æ‰€æœ‰å¯èƒ½çš„shadersï¼Ÿ</h4><p>If there were only a limited number of possible shaders, then Flutter could compile all of them when an application is built. However, for the best overall performance, the Skia GPU backend used by Flutter dynamically generates shaders based on many parameters at runtime (for example draws, device models, and driver versions). Due to all possible combinations of those parameters, the number of possible shaders multiplies quickly. In short, Flutter uses programs (app, Flutter, and Skia code) to generate some other programs (shaders).</p><p>å¦‚æœshadersæ•°é‡æœ‰ä¸Šé™ï¼Œé‚£ä¹ˆ Flutter å¯ä»¥åœ¨æ„å»ºAppæ—¶ç¼–è¯‘æ‰€æœ‰shadersã€‚ ç„¶è€Œï¼Œä¸ºäº†è·å¾—æœ€ä½³çš„æ•´ä½“æ€§èƒ½ï¼ŒFlutter ä½¿ç”¨çš„ Skia GPU åœ¨èƒŒåä¼šåœ¨è¿è¡Œæ—¶æ ¹æ®è®¸å¤šå‚æ•°ï¼ˆä¾‹å¦‚ç»˜å›¾ã€è®¾å¤‡æ¨¡å‹å’Œé©±åŠ¨ç¨‹åºç‰ˆæœ¬ï¼‰åŠ¨æ€ç”Ÿæˆshadersã€‚ ç”±äºè¿™äº›å‚æ•°çš„æ‰€æœ‰å¯èƒ½ç»„åˆï¼Œå¯èƒ½çš„shadersæ•°é‡è¿…é€Ÿå¢åŠ ã€‚ ç®€è€Œè¨€ä¹‹ï¼ŒFlutter ä½¿ç”¨ç¨‹åºï¼ˆappã€Flutter å’Œ Skia ä»£ç ï¼‰æ¥ç”Ÿæˆå…¶ä»–ä¸€äº›ç¨‹åºï¼ˆshadersï¼‰ã€‚</p><p>The number of possible shader programs that Flutter can generate is too large to precompute and bundle with an application.</p><p>Flutter å¯ä»¥ç”Ÿæˆçš„å¯èƒ½shadersç¨‹åºçš„æ•°é‡å¤ªå¤§è€Œæ— æ³•é¢„å…ˆè®¡ç®—å¹¶ä¸Appæ†ç»‘åœ¨ä¸€èµ·ã€‚</p><h4 id="Can-SkSLs-captured-from-one-device-help-shader-compilation-jank-on-another-device-ä»ä¸€å°è®¾å¤‡æ•è·çš„-SkSL-èƒ½å¦å¸®åŠ©shadersç¼–è¯‘åœ¨å¦ä¸€å°è®¾å¤‡ä¸Šå¡é¡¿ï¼Ÿ">Can SkSLs captured from one device help shader compilation jank on another device? -ä»ä¸€å°è®¾å¤‡æ•è·çš„ SkSL èƒ½å¦å¸®åŠ©shadersç¼–è¯‘åœ¨å¦ä¸€å°è®¾å¤‡ä¸Šå¡é¡¿ï¼Ÿ</h4><p>Theoretically, thereâ€™s no guarantee that the SkSLs from one device would help on another device (but they also wonâ€™t cause any troubles if SkSLs arenâ€™t compatible across devices). Practically, as shown in the table on this SkSL-based warmup issue, SkSLs work surprisingly well even if 1) SkSLs are captured from iOS and then applied to Android devices, or 2) SkSLs are captured from emulators and then applied to real mobile devices. As the Flutter team has only a limited number of devices in the lab, we currently donâ€™t have enough data to provide a big picture of cross-device effectiveness. Weâ€™d love you to provide us more data points to see how it works in the wildâ€”FrameTiming can be used to compute the worst frame rasterization time in release mode; the worst frame rasterization time is a good indicator on how severe the shader compilation jank is.</p><p>ä»ç†è®ºä¸Šè®²ï¼Œä¸èƒ½ä¿è¯æ¥è‡ªä¸€å°è®¾å¤‡çš„ SkSL ä¼šåœ¨å¦ä¸€å°è®¾å¤‡ä¸Šæœ‰æ‰€å¸®åŠ©ï¼ˆä½†å¦‚æœ SkSL ä¸èƒ½è·¨è®¾å¤‡å…¼å®¹ï¼Œå®ƒä»¬ä¹Ÿä¸ä¼šé€ æˆä»»ä½•é—®é¢˜ï¼‰ã€‚ å®é™…ä¸Šï¼Œå¦‚è¿™ä¸ªåŸºäº SkSL çš„é¢„çƒ­é—®é¢˜çš„è¡¨æ ¼æ‰€ç¤ºï¼Œå³ä½¿ 1) ä» iOS æ•è· SkSLï¼Œç„¶åå°†å…¶åº”ç”¨äº Android è®¾å¤‡ï¼Œæˆ–è€… 2) ä»æ¨¡æ‹Ÿå™¨æ•è· SkSLï¼Œç„¶åå°†å…¶åº”ç”¨äºçœŸå®çš„ç§»åŠ¨è®¾å¤‡ï¼ŒSkSL çš„å·¥ä½œæ•ˆæœä¹Ÿå‡ºå¥‡åœ°å¥½ . ç”±äº Flutter å›¢é˜Ÿåœ¨å®éªŒå®¤ä¸­åªæœ‰æœ‰é™æ•°é‡çš„è®¾å¤‡ï¼Œæˆ‘ä»¬ç›®å‰æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®æ¥æä¾›è·¨è®¾å¤‡æœ‰æ•ˆæ€§çš„å¤§å›¾ã€‚ æˆ‘ä»¬å¸Œæœ›ä½ æä¾›æ›´å¤šæ•°æ®ç‚¹ï¼Œçœ‹çœ‹å®ƒåœ¨å®éªŒå®¤ä¹‹å¤–æ˜¯å¦‚ä½•å·¥ä½œçš„â€”â€”FrameTiming å¯ç”¨äºè®¡ç®—releaseæ¨¡å¼ä¸‹æœ€å·®çš„rasteråŒ–æ—¶é—´ï¼› æœ€å·®å¸§rasteræ—¶é—´å¯ä»¥å¾ˆå¥½åœ°æŒ‡ç¤ºshadersç¼–è¯‘å¡é¡¿çš„ä¸¥é‡ç¨‹åº¦ã€‚</p><h4 id="Why-canâ€™t-you-create-a-single-â€œubershaderâ€-and-just-compile-that-once-ä¸ºä»€ä¹ˆä½ ä¸èƒ½åˆ›å»ºä¸€ä¸ªå•ä¸€çš„â€œubershaderâ€å¹¶ä¸”åªç¼–è¯‘ä¸€æ¬¡å‘¢ï¼Ÿ">Why canâ€™t you create a single â€œubershaderâ€ and just compile that once? -ä¸ºä»€ä¹ˆä½ ä¸èƒ½åˆ›å»ºä¸€ä¸ªå•ä¸€çš„â€œubershaderâ€å¹¶ä¸”åªç¼–è¯‘ä¸€æ¬¡å‘¢ï¼Ÿ</h4><p>One idea that people sometimes suggest is to create a single large shader that implements all of Skiaâ€™s features, and use that shader while the more optimized bespoke shaders are being compiled.</p><p>äººä»¬æœ‰æ—¶å»ºè®®çš„ä¸€ä¸ªæƒ³æ³•æ˜¯åˆ›å»ºä¸€ä¸ªå®ç° Skia æ‰€æœ‰åŠŸèƒ½çš„å¤§å‹shadersï¼Œå¹¶åœ¨ç¼–è¯‘æ›´ä¼˜åŒ–çš„å®šåˆ¶shadersæ—¶ä½¿ç”¨è¯¥shadersã€‚</p><p>This is similar to a solution used by the Dolphin Emulator.</p><p>è¿™ç±»ä¼¼äº Dolphin Emulator ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>In practice we believe implementing this for Flutter (or more specifically for Skia) would be impractical. Such a shader would be fantastically large, essentially reimplementing all of Skia on the GPU. This would itself take a long time to compile, thus introducing more jank; it would not necessarily be fast enough to avoid jank even when compiled; and it would likely introduce fidelity issues (e.g. flickering) since there would likely be differences in precise rendering between the optimized shaders and the â€œubershaderâ€.</p><p>åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬è®¤ä¸ºä¸º Flutterï¼ˆæˆ–æ›´å…·ä½“åœ°ä¸º Skiaï¼‰å®ç°è¿™ä¸€ç‚¹æ˜¯ä¸åˆ‡å®é™…çš„ã€‚ è¿™æ ·çš„shadersä¼šéå¸¸å¤§ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨ GPU ä¸Šé‡æ–°å®ç°æ‰€æœ‰ Skiaã€‚ è¿™æœ¬èº«ä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´æ¥ç¼–è¯‘ï¼Œä»è€Œå¼•å…¥æ›´å¤šçš„å¡é¡¿é—®é¢˜ï¼› å³ä½¿åœ¨ç¼–è¯‘æ—¶ï¼Œå®ƒä¹Ÿä¸ä¸€å®šè¶³å¤Ÿå¿«ä»¥é¿å…å¡é¡¿ï¼› å¹¶ä¸”å®ƒå¯èƒ½ä¼šå¼•å…¥ä¿çœŸåº¦é—®é¢˜ï¼ˆä¾‹å¦‚é—ªçƒï¼‰ï¼Œå› ä¸ºä¼˜åŒ–shaderså’Œâ€œubershaderâ€ä¹‹é—´çš„ç²¾ç¡®æ¸²æŸ“å¯èƒ½å­˜åœ¨å·®å¼‚ã€‚</p><p>That said, Flutter and Skia are open source and we are eager to see proofs-of-concept along these lines if this is something that interests you. To get started, please see our contribution guidelines.</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒFlutter å’Œ Skia æ˜¯å¼€æºçš„ï¼Œå¦‚æœä½ å¯¹æ­¤æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬æ¸´æœ›çœ‹åˆ°è¿™äº›æ–¹é¢çš„æ¦‚å¿µéªŒè¯ã€‚ è¦å¼€å§‹ä½¿ç”¨ï¼Œè¯·å‚é˜…æˆ‘ä»¬çš„è´¡çŒ®æŒ‡å—ã€‚</p><h3 id="Future-work-æœªæ¥çš„å·¥ä½œ">Future work - æœªæ¥çš„å·¥ä½œ</h3><p>On both Android and iOS, shader warm-up has a few drawbacks:</p><p>åœ¨ Android å’Œ iOS ä¸Šï¼Œshadersé¢„çƒ­éƒ½æœ‰ä¸€äº›ç¼ºç‚¹ï¼š</p><ol><li>The size of the deployed app is larger because it contains the bundled shaders.</li><li>å‘å¸ƒçš„Appçš„åŒ…ä½“ç§¯ä¼šæ›´å¤§ï¼Œå› ä¸ºå®ƒåŒ…å«æ†ç»‘çš„shadersã€‚</li><li>App startup latency is longer because the bundled shaders need to be precompiled.</li><li>Appå¯åŠ¨æ—¶é—´ä¼šè¾ƒé•¿ï¼Œå› ä¸ºæ†ç»‘çš„shaderséœ€è¦é¢„ç¼–è¯‘ã€‚</li></ol><p>Â </p><p>Â </p><h2 id="å‚è€ƒ">å‚è€ƒ</h2><blockquote><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://flutter.cn/docs/perf/best-practices">https://flutter.cn/docs/perf/best-practices</a></p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://juejin.cn/post/7066954522655981581">https://juejin.cn/post/7066954522655981581</a></p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://flutter.cn/docs/perf/shader">https://flutter.cn/docs/perf/shader</a></p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://flutter.cn/docs/development/tools/devtools/performance">https://flutter.cn/docs/development/tools/devtools/performance</a></p></blockquote></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…:</span> <span class="post-copyright-info"><a href="https://zwn2001.space">æ´›é›ª</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥:</span> <span class="post-copyright-info"><a href="https://zwn2001.space/posts/FLutter%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">https://zwn2001.space/posts/FLutter%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜:</span> <span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://zwn2001.space" target="_blank">ZWN's blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/flutter/">flutter</a></div><div class="post_share"><div class="social-share" data-image="/img/cover3/1-min.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://unpkg.com/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://unpkg.com/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/CSharp%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E9%97%A8/" title="CSharpä»å…¥é—¨åˆ°å…¥é—¨"><img class="cover" src="/img/cover2/8-min.jpg" onerror='onerror=null,src="/img/404.webp"' alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">CSharpä»å…¥é—¨åˆ°å…¥é—¨</div></div></a></div><div class="next-post pull-right"><a href="/posts/%E5%AE%89%E5%8D%93Jetpack%E4%BB%8E%E4%B8%A4%E7%9C%BC%E4%B8%80%E6%8A%B9%E9%BB%91%E5%88%B0%E4%B8%A4%E7%9C%BC%E4%B8%80%E9%BB%91/" title="å®‰å“Jetpackä»ä¸¤çœ¼ä¸€æŠ¹é»‘åˆ°ä¸¤çœ¼ä¸€é»‘"><img class="cover" src="/img/cover3/24-min.jpg" onerror='onerror=null,src="/img/404.webp"' alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">å®‰å“Jetpackä»ä¸¤çœ¼ä¸€æŠ¹é»‘åˆ°ä¸¤çœ¼ä¸€é»‘</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/Dart-Mixin/" title="Dart-Mixinæ˜¯ä»€ä¹ˆ"><img class="cover" src="/img/cover1/5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-23</div><div class="title">Dart-Mixinæ˜¯ä»€ä¹ˆ</div></div></a></div><div><a href="/posts/flutter-generate-uml/" title="flutterç”ŸæˆUML"><img class="cover" src="/img/cover1/2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-05</div><div class="title">flutterç”ŸæˆUML</div></div></a></div><div><a href="/posts/flutter-context/" title="flutter-context"><img class="cover" src="/img/cover3/22-min.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-20</div><div class="title">flutter-context</div></div></a></div><div><a href="/posts/flutter-key/" title="å­¦çº¿åŸ¹è®­ï¼šflutter-key"><img class="cover" src="/img/cover3/24-min.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-20</div><div class="title">å­¦çº¿åŸ¹è®­ï¼šflutter-key</div></div></a></div><div><a href="/posts/flutterweb%E9%BC%A0%E6%A0%87%E7%A7%BB%E5%85%A5%E6%97%B6%E6%94%B9%E5%8F%98card%E7%9A%84%E9%98%B4%E5%BD%B1/" title="flutterwebé¼ æ ‡ç§»å…¥æ—¶æ”¹å˜cardçš„é˜´å½±"><img class="cover" src="/img/cover1/6.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-29</div><div class="title">flutterwebé¼ æ ‡ç§»å…¥æ—¶æ”¹å˜cardçš„é˜´å½±</div></div></a></div><div><a href="/posts/flutter%E5%A6%82%E4%BD%95%E7%9B%91%E5%90%AC%E9%BC%A0%E6%A0%87-desktop/" title="flutterå¦‚ä½•ç›‘å¬é¼ æ ‡-desktop"><img class="cover" src="/img/cover1/3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-01</div><div class="title">flutterå¦‚ä½•ç›‘å¬é¼ æ ‡-desktop</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.webp" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">æ´›é›ª</div><div class="author-info__description">æˆ‘è™½æ— æ„é€é¹¿ï¼Œå´çŸ¥è‹ç”Ÿè‹¦æ¥š</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">139</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/ZWN2001"><i class="fab fa-github"></i><span>æˆ‘çš„Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ZWN2001" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æ–°åŸŸåï¼šwww.zwn2001.spaceï¼Œæœ‰æ•ˆæœŸï¼š10å¹´ã€‚https://www.zwn-blog.xyzå·²è¿‡æœŸã€‚è®¿é—®æ—¶å»ºè®®ç§‘å­¦ä¸Šç½‘ï¼Œå¦åˆ™åšå®¢å†…å…¬å¼æ¸²æŸ“ä¼šå‡ºç°é—®é¢˜ä¸”é€Ÿåº¦æ…¢ã€‚Ctrl+shift+rå¯å¼ºåˆ¶åˆ·æ–°ç½‘ç«™ä»¥é¿å…æµè§ˆå™¨ç¼“å­˜é€ æˆçš„æ›´æ–°ä¸åŠæ—¶</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">FLutteræ€§èƒ½ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87"><span class="toc-number">1.1.</span> <span class="toc-text">å‡†å¤‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Flutter-Inspector"><span class="toc-number">1.1.1.</span> <span class="toc-text">Flutter Inspector</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Repaint-Rainbow"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">Repaint Rainbow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">ä½œç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">ä½¿ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">ç¼ºç‚¹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%80%A7%E8%83%BD%E8%A7%86%E5%9B%BE-Performance-view"><span class="toc-number">1.1.2.</span> <span class="toc-text">ä½¿ç”¨æ€§èƒ½è§†å›¾ (Performance view)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%A7%E4%BA%8B%E4%BB%B6%E5%9B%BE%EF%BC%9A"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">å¸§äº‹ä»¶å›¾ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%BA%BF%E4%BA%8B%E4%BB%B6%E5%9B%BE%EF%BC%9A"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">æ—¶é—´çº¿äº‹ä»¶å›¾ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enhance-Tracing"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">Enhance Tracing</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="toc-number">1.2.</span> <span class="toc-text">æ€§èƒ½æŒ‡æ ‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B1%80%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.</span> <span class="toc-text">å¸ƒå±€åŠ è½½ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.1.</span> <span class="toc-text">å¸¸è§„ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-build-%E6%96%B9%E6%B3%95%E4%B8%AD%E6%89%A7%E8%A1%8C%E4%BA%86%E8%80%97%E6%97%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">åœ¨ build() æ–¹æ³•ä¸­æ‰§è¡Œäº†è€—æ—¶æ“ä½œ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Widget-%E8%80%8C%E4%B8%8D%E6%98%AF%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">ä½¿ç”¨ Widget è€Œä¸æ˜¯å‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-nil-%E5%8E%BB%E6%9B%BF%E4%BB%A3-Container-%E5%92%8C-SizedBox"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">ä½¿ç”¨ nil å»æ›¿ä»£ Container() å’Œ SizedBox()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.2.</span> <span class="toc-text">åˆ—è¡¨ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E4%BA%8E%E9%95%BF%E5%88%97%E8%A1%A8%EF%BC%8C%E8%AE%B0%E5%BE%97%E5%9C%A8-ListView-%E4%B8%AD%E4%BD%BF%E7%94%A8-itemExtent%E3%80%82"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">é’ˆå¯¹äºé•¿åˆ—è¡¨ï¼Œè®°å¾—åœ¨ ListView ä¸­ä½¿ç”¨ itemExtentã€‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%8F%E5%B0%91%E5%8F%AF%E6%8A%98%E5%8F%A0-ListView-%E7%9A%84%E6%9E%84%E5%BB%BA%E6%97%B6%E9%97%B4"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">å‡å°‘å¯æŠ˜å  ListView çš„æ„å»ºæ—¶é—´</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.3.</span> <span class="toc-text">æ·±å…¥ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%85%89%E6%A0%85%E7%BA%BF%E7%A8%8B"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">ä¼˜åŒ–å…‰æ …çº¿ç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8-key-%E5%8A%A0%E9%80%9F-Flutter-%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%85%89%E6%A0%85%E7%BA%BF%E7%A8%8B"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">ç”¨ key åŠ é€Ÿ Flutter çš„æ€§èƒ½ä¼˜åŒ–å…‰æ …çº¿ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.3.3.2.1.</span> <span class="toc-text">å…ƒç´ çš„ç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.3.2.2.</span> <span class="toc-text">ä¼˜åŒ–æ–¹å¼</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%98%E5%8A%BF"><span class="toc-number">1.3.3.2.3.</span> <span class="toc-text">ä¼˜åŠ¿</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-2"><span class="toc-number">1.3.3.2.4.</span> <span class="toc-text">ç¼ºç‚¹</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E7%BC%96%E8%AF%91Shader"><span class="toc-number">1.4.</span> <span class="toc-text">é¢„ç¼–è¯‘Shader</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#What-is-shader-compilation-jank-%E4%BB%80%E4%B9%88%E6%98%AFshaders%E7%BC%96%E8%AF%91%E5%8D%A1%E9%A1%BF%EF%BC%9F"><span class="toc-number">1.4.1.</span> <span class="toc-text">What is shader compilation jank? -ä»€ä¹ˆæ˜¯shadersç¼–è¯‘å¡é¡¿ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#What-do-we-mean-by-%E2%80%9Cfirst-run%E2%80%9D-%E6%88%91%E4%BB%AC%E6%89%80%E8%AF%B4%E7%9A%84%E2%80%9C%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%BF%90%E8%A1%8C%E2%80%9D%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D%EF%BC%9F"><span class="toc-number">1.4.2.</span> <span class="toc-text">What do we mean by â€œfirst runâ€? - æˆ‘ä»¬æ‰€è¯´çš„â€œç¬¬ä¸€æ¬¡è¿è¡Œâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How-to-use-SkSL-warmup-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-SkSL-%E7%83%AD%E8%BA%AB"><span class="toc-number">1.4.3.</span> <span class="toc-text">How to use SkSL warmup - å¦‚ä½•ä½¿ç”¨ SkSL çƒ­èº«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Frequently-asked-questions-%E5%B8%B8%E9%97%AE%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.4.</span> <span class="toc-text">Frequently asked questions- å¸¸é—®çš„é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Why-not-just-compile-or-warm-up-all-possible-shaders-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E7%9B%B4%E6%8E%A5%E7%BC%96%E8%AF%91%E6%88%96%E9%A2%84%E7%83%AD%E6%89%80%E6%9C%89%E5%8F%AF%E8%83%BD%E7%9A%84shaders%EF%BC%9F"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">Why not just compile or warm up all possible shaders? - ä¸ºä»€ä¹ˆä¸ç›´æ¥ç¼–è¯‘æˆ–é¢„çƒ­æ‰€æœ‰å¯èƒ½çš„shadersï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Can-SkSLs-captured-from-one-device-help-shader-compilation-jank-on-another-device-%E4%BB%8E%E4%B8%80%E5%8F%B0%E8%AE%BE%E5%A4%87%E6%8D%95%E8%8E%B7%E7%9A%84-SkSL-%E8%83%BD%E5%90%A6%E5%B8%AE%E5%8A%A9shaders%E7%BC%96%E8%AF%91%E5%9C%A8%E5%8F%A6%E4%B8%80%E5%8F%B0%E8%AE%BE%E5%A4%87%E4%B8%8A%E5%8D%A1%E9%A1%BF%EF%BC%9F"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">Can SkSLs captured from one device help shader compilation jank on another device? -ä»ä¸€å°è®¾å¤‡æ•è·çš„ SkSL èƒ½å¦å¸®åŠ©shadersç¼–è¯‘åœ¨å¦ä¸€å°è®¾å¤‡ä¸Šå¡é¡¿ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Why-can%E2%80%99t-you-create-a-single-%E2%80%9Cubershader%E2%80%9D-and-just-compile-that-once-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%A0%E4%B8%8D%E8%83%BD%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8D%95%E4%B8%80%E7%9A%84%E2%80%9Cubershader%E2%80%9D%E5%B9%B6%E4%B8%94%E5%8F%AA%E7%BC%96%E8%AF%91%E4%B8%80%E6%AC%A1%E5%91%A2%EF%BC%9F"><span class="toc-number">1.4.4.3.</span> <span class="toc-text">Why canâ€™t you create a single â€œubershaderâ€ and just compile that once? -ä¸ºä»€ä¹ˆä½ ä¸èƒ½åˆ›å»ºä¸€ä¸ªå•ä¸€çš„â€œubershaderâ€å¹¶ä¸”åªç¼–è¯‘ä¸€æ¬¡å‘¢ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Future-work-%E6%9C%AA%E6%9D%A5%E7%9A%84%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.4.5.</span> <span class="toc-text">Future work - æœªæ¥çš„å·¥ä½œ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">1.5.</span> <span class="toc-text">å‚è€ƒ</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/2023%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BE%E8%AE%BE%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/" title="2023æ•°æ®åº“è¯¾è®¾ç»éªŒåˆ†äº«"><img src="/img/cover2/15-min.jpg" onerror='this.onerror=null,this.src="/img/404.webp"' alt="2023æ•°æ®åº“è¯¾è®¾ç»éªŒåˆ†äº«"></a><div class="content"><a class="title" href="/posts/2023%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BE%E8%AE%BE%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/" title="2023æ•°æ®åº“è¯¾è®¾ç»éªŒåˆ†äº«">2023æ•°æ®åº“è¯¾è®¾ç»éªŒåˆ†äº«</a><time datetime="2023-08-18T08:01:49.000Z" title="å‘è¡¨äº 2023-08-18 16:01:49">2023-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/%E5%88%A0%E9%99%A4gitignore%E4%BF%AE%E6%94%B9%E5%89%8D%E6%8F%90%E4%BA%A4%E7%9A%84%E5%A4%A7%E6%96%87%E4%BB%B6/" title="åˆ é™¤gitignoreä¿®æ”¹å‰æäº¤çš„å¤§æ–‡ä»¶"><img src="/img/cover2/18-min.jpg" onerror='this.onerror=null,this.src="/img/404.webp"' alt="åˆ é™¤gitignoreä¿®æ”¹å‰æäº¤çš„å¤§æ–‡ä»¶"></a><div class="content"><a class="title" href="/posts/%E5%88%A0%E9%99%A4gitignore%E4%BF%AE%E6%94%B9%E5%89%8D%E6%8F%90%E4%BA%A4%E7%9A%84%E5%A4%A7%E6%96%87%E4%BB%B6/" title="åˆ é™¤gitignoreä¿®æ”¹å‰æäº¤çš„å¤§æ–‡ä»¶">åˆ é™¤gitignoreä¿®æ”¹å‰æäº¤çš„å¤§æ–‡ä»¶</a><time datetime="2023-07-10T13:50:49.000Z" title="å‘è¡¨äº 2023-07-10 21:50:49">2023-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%8D%9A%E5%AE%A2%E5%85%AC%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%8E%92%E6%9F%A5/" title="è®°ä¸€æ¬¡åšå®¢å…¬å¼æ¸²æŸ“æ’æŸ¥"><img src="/img/cover3/34.jpg" onerror='this.onerror=null,this.src="/img/404.webp"' alt="è®°ä¸€æ¬¡åšå®¢å…¬å¼æ¸²æŸ“æ’æŸ¥"></a><div class="content"><a class="title" href="/posts/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%8D%9A%E5%AE%A2%E5%85%AC%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%8E%92%E6%9F%A5/" title="è®°ä¸€æ¬¡åšå®¢å…¬å¼æ¸²æŸ“æ’æŸ¥">è®°ä¸€æ¬¡åšå®¢å…¬å¼æ¸²æŸ“æ’æŸ¥</a><time datetime="2023-06-23T01:21:51.000Z" title="å‘è¡¨äº 2023-06-23 09:21:51">2023-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/%E5%A4%A9%E9%99%85%E7%BA%BF%E7%9A%84%E5%8F%A6%E4%B8%80%E8%BE%B9/" title="å¤©é™…çº¿çš„å¦ä¸€è¾¹"><img src="/img/cover3/19-min.jpg" onerror='this.onerror=null,this.src="/img/404.webp"' alt="å¤©é™…çº¿çš„å¦ä¸€è¾¹"></a><div class="content"><a class="title" href="/posts/%E5%A4%A9%E9%99%85%E7%BA%BF%E7%9A%84%E5%8F%A6%E4%B8%80%E8%BE%B9/" title="å¤©é™…çº¿çš„å¦ä¸€è¾¹">å¤©é™…çº¿çš„å¦ä¸€è¾¹</a><time datetime="2023-06-20T10:12:59.000Z" title="å‘è¡¨äº 2023-06-20 18:12:59">2023-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/A-star%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/" title="A-starè·¯å¾„è§„åˆ’"><img src="/img/cover3/22-min.jpg" onerror='this.onerror=null,this.src="/img/404.webp"' alt="A-starè·¯å¾„è§„åˆ’"></a><div class="content"><a class="title" href="/posts/A-star%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/" title="A-starè·¯å¾„è§„åˆ’">A-starè·¯å¾„è§„åˆ’</a><time datetime="2023-06-19T13:17:15.000Z" title="å‘è¡¨äº 2023-06-19 21:17:15">2023-06-19</time></div></div></div></div></div></div></main><footer id="footer" style="background:0 0"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç®€</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div><hr><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();" rel="external nofollow noreferrer"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();" rel="external nofollow noreferrer"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();" rel="external nofollow noreferrer"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();" rel="external nofollow noreferrer"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>å¤åˆ¶</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.google.com/search?q=&quot;+window.getSelection().toString());" rel="external nofollow noreferrer"><i class="iconfont icon-baidu"></i><span>æœç´¢</span></a><a class="rightMenu-item" href="javascript:rmf.searchinThisPage();" rel="external nofollow noreferrer"><i class="fas fa-search"></i><span>ç«™å†…æœç´¢</span></a><a class="rightMenu-item" href="#post-comment" onclick="rmf.yinyong()"><i class="fa-solid fa-message"></i><span>å¼•ç”¨æ–‡æœ¬è¯„è®º</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();" rel="external nofollow noreferrer"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>ç²˜è´´</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()" rel="external nofollow noreferrer"><i class="fa fa-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()" rel="external nofollow noreferrer"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>å¤åˆ¶é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()" rel="external nofollow noreferrer"><i class="fa fa-download"></i><span>ä¿å­˜å›¾ç‰‡</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()" rel="external nofollow noreferrer"><i class="fa fa-window-restore"></i><span>åœ¨æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" href="javascript:rmf.click()" rel="external nofollow noreferrer"><i class="fa fa-arrows-alt"></i><span>å…¨å±æ˜¾ç¤º</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>å¤åˆ¶å›¾ç‰‡é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:rmf.switchDarkMode();" rel="external nofollow noreferrer"><i class="fa fa-moon"></i><span>æ˜¼å¤œåˆ‡æ¢</span></a><a class="rightMenu-item" href="javascript:rmf.translate();" rel="external nofollow noreferrer"><i class="iconfont icon-fanti"></i><span>ç¹ç®€è½¬æ¢</span></a><a class="rightMenu-item" href="javascript:rmf.switchReadMode();" rel="external nofollow noreferrer"><i class="fa fa-book"></i><span>é˜…è¯»æ¨¡å¼</span></a><a class="rightMenu-item" href="javascript:fullScreen();" rel="external nofollow noreferrer"><i class="fas fa-expand"></i><span>è¿›å…¥å…¨å±</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://unpkg.com/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="https://unpkg.com/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://unpkg.com/pangu/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){GLOBAL_CONFIG_SITE.isPost&&panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://unpkg.com/katex/dist/katex.min.css"><script src="https://unpkg.com/katex/dist/contrib/copy-tex.min.js"></script><script>document.querySelectorAll("#article-container span.katex-display").forEach(a=>{btf.wrap(a,"div",{class:"katex-wrap"})})</script><script>function getGiscusTheme(e){return"dark"===e?"dark":"light"}function loadGiscus(){var e,t=Object.assign({src:"https://giscus.app/client.js","data-repo":"ZWN2001/ZWN2001.github.io","data-repo-id":"R_kgDOGH1XWg","data-category-id":"DIC_kwDOGH1XWs4CXnHJ","data-mapping":"pathname","data-theme":getGiscusTheme(document.documentElement.getAttribute("data-theme")),"data-reactions-enabled":"1",crossorigin:"anonymous",async:!0},{"data-lang":"zh-CN","data-loading":"lazy",crossorigin:"anonymous","data-mapping":"og:title","data-input-position":"top","data-category":"Announcements"}),a=document.createElement("script");for(e in t)a.setAttribute(e,t[e]);document.getElementById("giscus-wrap").insertAdjacentElement("afterbegin",a)}function changeGiscusTheme(e){var t;e={setConfig:{theme:getGiscusTheme(e)}},(t=document.querySelector("iframe.giscus-frame"))&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")}function loadOtherComment(){loadGiscus()}btf.addModeChange("giscus",changeGiscusTheme),btf.loadComment(document.getElementById("giscus-wrap"),loadGiscus)</script></div><script type="text/javascript" src="https://cdn1.tianli0.top/npm/jquery@latest/dist/jquery.min.js"></script><script type="text/javascript" src="/js/rightmenu.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div><hr><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><script data-pjax src="https://fastly.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script><script data-pjax>function GithubCalendarConfig(){var t=document.getElementById("recent-posts");t&&"/"==location.pathname&&(console.log("å·²æŒ‚è½½github calendar"),t.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>')),GithubCalendar("https://my-hexo-github-calender.vercel.app/api/?ZWN2001",["#ebedf0","#f1f8ff","#dbedff","#c8e1ff","#79b8ff","#2188ff","#0366d6","#005cc5","#044289","#032f62","#05264c"],"ZWN2001")}document.getElementById("recent-posts")&&GithubCalendarConfig()</script><style>#github_container{min-height:280px}@media screen and (max-width:650px){#github_container{min-height:0}}</style><style></style><script data-pjax>var parent,child;document.getElementById("recent-posts")&&"/"===location.pathname&&(parent=document.getElementById("recent-posts"),child='<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://zwn2001.space/categories/ç¼–ç¨‹çŸ¥è¯†/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“š æ´›é›ªã®ç¼–ç¨‹çŸ¥è¯† (17)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zwn2001.space/categories/å®ç”¨çŸ¥è¯†/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ’¡ æ´›é›ªã®å®ç”¨çŸ¥è¯† (14)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zwn2001.space/categories/å­¦ä¹ -è¯¾å¤–æ‹“å±•/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ‘©â€ğŸ’» æ´›é›ªã®å­¦ä¹ -è¯¾å¤–æ‹“å±• (20)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zwn2001.space/categories/å­¦ä¹ -è¯¾å†…çŸ¥è¯†/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“’ æ´›é›ªã®å­¦ä¹ -è¯¾å†…çŸ¥è¯† (57)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://zwn2001.space/categories" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>',console.log("å·²æŒ‚è½½magnet"),parent.insertAdjacentHTML("afterbegin",child))</script><style>#catalog_magnet{flex-wrap:wrap;display:flex;width:100%;justify-content:space-between;padding:10px 10px 0 10px;align-content:flex-start}.magnet_item{flex-basis:calc(50% - 5px);background:#f2f2f2;margin-bottom:10px;border-radius:8px;transition:all .2s ease-in-out}.magnet_item:hover{background:#b30070}.magnet_link_more{color:#555}.magnet_link{color:#000}.magnet_link:hover{color:#fff}@media screen and (max-width:600px){.magnet_item{flex-basis:100%}}.magnet_link_context{display:flex;padding:10px;font-size:16px;transition:all .2s ease-in-out}.magnet_link_context:hover{padding:10px 20px}</style><style></style></body></html>