<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>2021限选课web踩坑汇总 | ZWN's blog</title><meta name="keywords" content="前端"><meta name="author" content="ZWN"><meta name="copyright" content="ZWN"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言： web课设遇到了一些阻力，以前常常听人说“大前端”，我常常嗤之以鼻，从前我觉得现在的技术栈，前端也好，后端也罢，乃至移动开发、嵌入式、人工智能等等等等，没有一个领域不配称之为“大”，然而现在才觉得，前端确实很大。从html到css、js等等等等，乃至后来的一些elementUI再到Vue，这仅仅是我接触到的冰山一角。有很多规范与等着我去了解、学习、使用，有很多库可以被调用但我对他们一无所知">
<meta property="og:type" content="article">
<meta property="og:title" content="2021限选课web踩坑汇总">
<meta property="og:url" content="https://zwn2001.github.io/2021/11/06/2021%E9%99%90%E9%80%89%E8%AF%BEweb%E8%B8%A9%E5%9D%91%E6%B1%87%E6%80%BB/index.html">
<meta property="og:site_name" content="ZWN&#39;s blog">
<meta property="og:description" content="前言： web课设遇到了一些阻力，以前常常听人说“大前端”，我常常嗤之以鼻，从前我觉得现在的技术栈，前端也好，后端也罢，乃至移动开发、嵌入式、人工智能等等等等，没有一个领域不配称之为“大”，然而现在才觉得，前端确实很大。从html到css、js等等等等，乃至后来的一些elementUI再到Vue，这仅仅是我接触到的冰山一角。有很多规范与等着我去了解、学习、使用，有很多库可以被调用但我对他们一无所知">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zwn2001.github.io/img/cover1/6.jpg">
<meta property="article:published_time" content="2021-11-06T10:13:09.000Z">
<meta property="article:modified_time" content="2022-08-07T04:46:19.203Z">
<meta property="article:author" content="ZWN">
<meta property="article:tag" content="前端">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zwn2001.github.io/img/cover1/6.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zwn2001.github.io/2021/11/06/2021%E9%99%90%E9%80%89%E8%AF%BEweb%E8%B8%A9%E5%9D%91%E6%B1%87%E6%80%BB/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/pwa/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/pwa/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/pwa/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/pwa/16.png"/><link rel="mask-icon" href="/pwa/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: ZWN","link":"链接: ","source":"来源: ZWN's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '2021限选课web踩坑汇总',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-07 12:46:19'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.app-refresh{position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease}.app-refresh-wrap{display:flex;color:#fff;height:100%;align-items:center;justify-content:center}.app-refresh-wrap a{color:#fff;text-decoration:underline;cursor:pointer}</style><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cover1/6.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">ZWN's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">2021限选课web踩坑汇总</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-06T10:13:09.000Z" title="发表于 2021-11-06 18:13:09">2021-11-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-07T04:46:19.203Z" title="更新于 2022-08-07 12:46:19">2022-08-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>32分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="2021限选课web踩坑汇总"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>前言：</h1>
<p>web课设遇到了一些阻力，以前常常听人说“大前端”，我常常嗤之以鼻，从前我觉得现在的技术栈，前端也好，后端也罢，乃至移动开发、嵌入式、人工智能等等等等，没有一个领域不配称之为“大”，然而现在才觉得，前端确实很大。从html到css、js等等等等，乃至后来的一些elementUI再到Vue，这仅仅是我接触到的冰山一角。有很多规范与等着我去了解、学习、使用，有很多库可以被调用但我对他们一无所知，有很多标签、属性等着我去了解、熟悉，凡此种种，令人头疼。</p>
<p>另一方面，从前的开发经验带给了我束缚。对于移动开发者来说，标签的嵌套规则已经熟悉的不能再熟悉，所需要熟悉的不过是标签名与属性。但一方面，传统的MVC架构思路带给了我太大的束缚，让我一时很难接受MVVM这种从未见过的架构模式。</p>
<p>MVC与MVVM：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="0.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="1.png" alt=""></p>
<p>但还是逐渐熟悉了MVVM，感谢这篇博客给我的启发：<a target="_blank" rel="noopener" href="https://draveness.me/mvx/">浅谈 MVC、MVP 和 MVVM 架构模式</a></p>
<p>不过，另一方面，移动开发与web一个特别大的差异就在于，web没有任何的布局规范，而移动开发几乎全部的UI绘制都遵循特定的规范。这就导致很长一段时间以来我的``</template>`标签内一直混乱不堪。web给了开发这对于UI的更高自由度，这是受产品需求影响的，移动开发对界面几乎没有任何缩放需求，而一个web界面就要适应人们对窗口的缩放与界面上更多、更复杂的元素的位置的控制。</p>
<p> </p>
<h1>1.computed和methods的区别</h1>
<p><code>&lt;script&gt;</code>中，compute与method都代表着方法的集合。不过，区别还是不小：</p>
<h2 id="computed">computed</h2>
<blockquote>
<p>computed属性是Vue的计算属性，是数据层到视图层的数据转化反映;</p>
<p>计算属性是基于他们的依赖进行缓存的，只有在相关依赖发生改变时，他们才会重新求值，也就是说，只要他的依赖没有发生变化，那么每次访问的时候计算属性都会立即返回之前的计算结果，不再执行函数；</p>
</blockquote>
<h2 id="区别">区别</h2>
<blockquote>
<p>1.computed是响应式的，methods并非响应式。</p>
<p>2.<strong>computed是带缓存的，只有依赖数据发生改变，才会重新进行计算</strong>，而methods里的函数在每次调用时都要执行。</p>
<p>3.<strong>computed中的成员可以只定义一个函数作为只读属性，也可以定义get/set变成可读属性</strong>，这点是methods的成员做不到的。</p>
<p>4.<strong>computed不支持异步</strong>，当computed内有异步操作时无效，无法监听数据的变化</p>
<p>5.computed是<strong>属性访问</strong>，而methods是<strong>函数调用</strong></p>
<p>6.在<code>HTML</code>的插值里</p>
<ol>
<li><strong>computed定义的方法我们是以属性的形式访问的</strong>，和<code>data</code>里的属性访问形式一样，<code>&#123;&#123;computedTest&#125;&#125;</code></li>
<li>但是methods定义的方法，我们必须要加上<code>()</code>来调用，如<code>&#123;&#123;methodTest()&#125;&#125;</code></li>
</ol>
</blockquote>
<h2 id="注意">注意</h2>
<blockquote>
<p>如果声明的计算属性计算量非常大的时候，而且访问量次数非常多，改变的时机却很小，那就需要用到computed；缓存会让我们减少很多计算量。</p>
</blockquote>
<p>作者：hualayou，有删改<br>
链接：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d69a875b769e">https://www.jianshu.com/p/d69a875b769e</a></p>
<p> </p>
<h1>2.跨域</h1>
<h2 id="一、什么是跨域HTTP请求">一、什么是跨域HTTP请求</h2>
<p>现代浏览器出于安全的考虑，使用 XMLHttpRequest对象发起 HTTP请求时必须遵守同源策略，否则就是跨域的HTTP请求，默认情况下是被禁止的。<strong>跨域HTTP请求是指A域上资源请求了B域上的资源</strong>，举例而言，部署在A机器上Nginx上的js代码通过ajax请求了部署在B机器Tomcat上的RESTful接口。</p>
<p>IP（域名）不同、或者端口不同，都会造成跨域问题。为了解决跨域的问题，曾经出现过jsonp、代理文件等方案，应用场景受限，维护成本高，直到HTML5带来了CORS协议。</p>
<p>CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing），允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。它通过服务器增加一个特殊Header[Access-Control-Allow-Origin]来告诉客户端跨域的限制，如果浏览器支持CORS、并且判断Origin通过的话，就会允许XMLHttpRequest发起跨域请求。</p>
<h2 id="二、CROS常见header">二、CROS常见header</h2>
<p>Access-Control-Allow-Origin: <code>http://****.com</code>表示允许<code>http://****.com</code>发起跨域请求。<br>
Access-Control-Max-Age:86400 表示在86400秒内不需要再发送预校验请求。<br>
Access-Control-Allow-Methods: GET,POST,PUT,DELETE 表示允许跨域请求的方法。<br>
Access-Control-Allow-Headers: content-type 表示允许跨域请求包含content-type</p>
<h2 id="三、CORS实现跨域访问">三、CORS实现跨域访问</h2>
<p>授权方式<br>
方式1：返回新的<code>CorsFilter</code><br>
方式2：重写<code>WebMvcConfigurer</code><br>
方式3：使用注解（<code>@CrossOrigin</code>）<br>
方式4：手工设置响应头（<code>HttpServletResponse</code> ）</p>
<blockquote>
<p>注：方式1和方式2属于全局CORS配置，方式3和方式4属于局部CORS配置。如果使用了局部跨域是会覆盖全局跨域的规则，所以可以通过<code>@CrossOrigin</code>注解来进行细粒度更高的跨域资源控制。</p>
</blockquote>
<h3 id="1-返回新的CorsFilter-全局跨域">1.返回新的<code>CorsFilter</code>(全局跨域)</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalCorsConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsFilter <span class="title">corsFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.添加CORS配置信息</span></span><br><span class="line">        CorsConfiguration config = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">          <span class="comment">//放行哪些原始域</span></span><br><span class="line">          config.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">          <span class="comment">//是否发送Cookie信息</span></span><br><span class="line">          config.setAllowCredentials(<span class="keyword">true</span>);</span><br><span class="line">          <span class="comment">//放行哪些原始域(请求方式)</span></span><br><span class="line">          config.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">          <span class="comment">//放行哪些原始域(头部信息)</span></span><br><span class="line">          config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">          <span class="comment">//暴露哪些头部信息（因为跨域访问默认不能获取全部头部信息）</span></span><br><span class="line">          config.addExposedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.添加映射路径</span></span><br><span class="line">        UrlBasedCorsConfigurationSource configSource = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        configSource.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, config);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.返回新的CorsFilter.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsFilter(configSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-创建一个-filter-解决跨域">2.创建一个 filter 解决跨域</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">@WebFilter(urlPatterns = &#123; &quot;/*&quot; &#125;, filterName = &quot;headerFilter&quot;)</span><br><span class="line">public class HeaderFilter implements Filter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void doFilter(ServletRequest request, ServletResponse resp, FilterChain chain) throws IOException, ServletException &#123;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) resp;</span><br><span class="line">        //解决跨域访问报错</span><br><span class="line">        response.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span><br><span class="line">        response.setHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;POST, PUT, GET, OPTIONS, DELETE&quot;);</span><br><span class="line">        //设置过期时间</span><br><span class="line">        response.setHeader(&quot;Access-Control-Max-Age&quot;, &quot;3600&quot;);</span><br><span class="line">        response.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;Origin, X-Requested-With, Content-Type, Accept, client_id, uuid, Authorization&quot;);</span><br><span class="line">        // 支持HTTP 1.1.</span><br><span class="line">        response.setHeader(&quot;Cache-Control&quot;, &quot;no-cache, no-store, must-revalidate&quot;);</span><br><span class="line">        // 支持HTTP 1.0. response.setHeader(&quot;Expires&quot;, &quot;0&quot;);</span><br><span class="line">        response.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;);</span><br><span class="line">        // 编码</span><br><span class="line">        response.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">        chain.doFilter(request, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void init(FilterConfig filterConfig) &#123;</span><br><span class="line">        log.info(&quot;跨域过滤器启动&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void destroy() &#123;</span><br><span class="line">        log.info(&quot;跨域过滤器销毁&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-重写WebMvcConfigurer（全局跨域）">3. 重写<code>WebMvcConfigurer</code>（全局跨域）</h3>
<p>任意配置类，返回一个新的<code>WebMvcConfigurer Bean</code>，并重写其提供的跨域请求处理的接口，目的是添加映射路径和具体的CORS配置信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalCorsConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">corsConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="comment">//重写父类提供的跨域请求处理的接口</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//添加映射路径</span></span><br><span class="line">                registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                        <span class="comment">//放行哪些原始域</span></span><br><span class="line">                        .allowedOrigins(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                        <span class="comment">//是否发送Cookie信息</span></span><br><span class="line">                        .allowCredentials(<span class="keyword">true</span>)</span><br><span class="line">                        <span class="comment">//放行哪些原始域(请求方式)</span></span><br><span class="line">                        .allowedMethods(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>)</span><br><span class="line">                        <span class="comment">//放行哪些原始域(头部信息)</span></span><br><span class="line">                        .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                        <span class="comment">//暴露哪些头部信息（因为跨域访问默认不能获取全部头部信息）</span></span><br><span class="line">                        .exposedHeaders(<span class="string">&quot;Header1&quot;</span>, <span class="string">&quot;Header2&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-使用注解（局部跨域）">4. 使用注解（局部跨域）</h3>
<p>在方法上（<code>@RequestMapping</code>）使用注解 <code>@CrossOrigin</code> ：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(<span class="meta-string">&quot;/hello&quot;</span>)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@CrossOrigin(<span class="meta-string">&quot;http://localhost:8080&quot;</span>)</span> </span><br><span class="line"><span class="keyword">public</span> String index( )&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者在控制器（@Controller）上使用注解 <code>@CrossOrigin</code> ：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@CrossOrigin(origins = <span class="meta-string">&quot;http://xx-domain.com&quot;</span>, maxAge = 3600)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(<span class="meta-string">&quot;/hello&quot;</span>)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String index( )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-手工设置响应头（局部跨域-）">5.手工设置响应头（局部跨域 ）</h3>
<p>使用<code>HttpServletResponse</code>对象添加响应头（Access-Control-Allow-Origin）来授权原始域，这里Origin的值也可以设置为&quot;*&quot; ，表示全部放行。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/hello&quot;</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">String</span> <span class="function"><span class="title">index</span>(<span class="params">HttpServletResponse response</span>)</span>&#123;</span><br><span class="line">    response.addHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;http://localhost:8080&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> </p>
<h1>3.判断合法</h1>
<h2 id="数字">数字</h2>
<p>小问题，普适的方法：正则</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> re = <span class="regexp">/^[0-9]+.?[0-9]*/</span>;</span><br><span class="line">            <span class="keyword">if</span> (!re.test(<span class="built_in">this</span>.form_add.credit)) &#123;</span><br><span class="line">                alert(<span class="string">&quot;学分请输入数字&quot;</span>);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h2 id="邮箱">邮箱</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pat = <span class="string">&#x27;[a-zA-Z0-9]+@[a-zA-Z0-9]+\.[a-zA-Z0-9]+&#x27;</span></span><br></pre></td></tr></table></figure>
<p> </p>
<h1>4.我为什么不用外键</h1>
<blockquote>
<p>2022.8.7.仁者见仁，如果系统需要经常增删改，外键不算是太好的选择，如果系统以查询为主，外键未尝不可</p>
</blockquote>
<p>在关系型数据库中，外键也被称为关系键，它是关系型数据库中提供关系表之间连接的多个列，这一组数据列是当前关系表中的外键，也必须是另一个关系表中的候选键（Candidate Key），我们可以通过候选键在当前表中找到唯一的元素。在通常情况下，我们都会使用关系表中的主键作为其他表中的外键，这样才可以满足关系型数据库对外键的约束。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="2.jpg" alt=""></p>
<p>外键不仅仅是数据库表中的一个整数，<strong>它还提供了额外的一致性保证</strong>。因为数据库往往是整个系统的真理之源（Source of Truth），所以保证数据的<strong>一致性和正确性</strong>非常重要，关系型数据库虽然提供了外键、触发器等特性保证一致性，而且虽然此次实验里面也提到了外键，但是在今天的生产环境中却很少被使用，并且我也不准备使用。</p>
<p>引用完整性（Referential Integrity）是数据的属性，如果数据拥有该属性，那么数据中所有的引用都是合法的，在关系型数据库的上下文中，这就意味着<strong>关系型数据库中引用另一个表中的值必须存在</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> posts</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="keyword">FOREIGN</span> KEY (author_id)</span><br><span class="line"><span class="keyword">REFERENCES</span> authors(id);</span><br></pre></td></tr></table></figure>
<p>上述 SQL 语句可以向关系表中增加外键约束，该 SQL 语句的执行前提是 <code>posts</code> 表中存在 <code>author_id</code> 字段。从 SQL 语句中的 <code>CONSTRAINT</code> 关键字我们也能推测出外键不是一种数据类型，<strong>它是不同关系表之间的约束</strong>。</p>
<p><strong>不使用外键的原因其实很简单，MySQL、PostgreSQL 等关系型数据库很难水平扩容，但是无状态的服务往往都可以很容易地扩容。由于外键等特性需要数据库执行额外的工作，而这些操作会占用数据库的计算资源，所以我们可以将大部分的需求都迁移到无状态的服务中完成以降低数据库的工作负载。</strong></p>
<p>根据更新和删除时的行为不同，我们可以将外键分成 <code>RESTRICT</code>、<code>CASCADE</code> 和 <code>SET NULL</code> 等几种，当我们为关系表中的字段增加外键约束时，需要指定外键的类型，最常见的也就是 <code>RESTRICT</code> 和 <code>CASCADE</code> 两种，其中 <code>RESTRICT</code> 为外键的默认类型，<strong>不同类型的外键会带来不同的额外开销，而这些额外开销就是我们不使用外键的理由：</strong></p>
<ul>
<li>使用 <code>RESTRICT</code> 会在更新或者删除记录时对外键对应的记录是否存在进行一致性检查；</li>
<li>使用 <code>CASCADE</code> 会在更新或者删除记录时触发级联更新或者删除操作；</li>
</ul>
<blockquote>
<p>注意：MySQL 中的 <code>NO ACTION</code> 和 <code>RESTRICT</code> 具有相同的语义</p>
</blockquote>
<p>而在<a target="_blank" rel="noopener" href="https://dba.stackexchange.com/questions/77906/what-is-the-cost-of-adding-a-foreign-key-in-mysql">这个回答</a>中，作者对是否使用外键给了一些理由：</p>
<blockquote>
<p>In MySQL, a foreign key requires an index. If an index already exists, the foreign key will use that index (even using the prefix of an existing multi-column index). If no index exists, defining the foreign key will build the index.</p>
<p>So the size increase and time to create a foreign key is about the same as to create an index on the same column(s).</p>
<p>The performance of a SELECT is not impacted significantly by the presence of a foreign key. Only a slight additional work for the optimizer, to consider the new indexes.</p>
<p>The performance of updating is more, because for each foreign key, an INSERT/UPDATE/DELETE has to check to see if the constraint is satisfied. That means a primary key lookup to the referenced tables. This impact is measurable, and it is greater if the referenced tables are not in the buffer pool.</p>
<p>Another impact is the locking. If I update a row in a child row that has a foreign key, InnoDB places a shared-lock on the referenced rows in the parent tables. That means no one can update those parent rows until I commit. If you have lots of threads updating child rows, then the parent rows may be locked most of the time, and this can make it hard to do concurrent work in the parent tables. Not so much a performance problem, but a concurrency problem.</p>
<p>As with all “how does that perform” questions, the answer really depends on your workload. If you don’t have concurrent updates, for example, that issue may not effect you for all practical purposes. Testing it yourself with load testing is the only way to be sure. It’s not something anyone on StackOverflow can answer precisely for you.</p>
</blockquote>
<p>总结一下，一方面就是select受性能外键影响不大，但是INSERT/UPDATE/DELETE的性能会受到较大影响，因为检查参数是否满足条件需要额外的性能支出，如果数据表不在缓冲池会导致更高的性能亏损。另一方面就是外键的加锁策略导致在并发量较高的情况下程序等待锁被释放而引发的性能亏损，与单表索引不同的是，它会引用一张或多张父表，这样当对子表进行写入操作(UPDATE/INSERT)的时候，父表就会被加上“共享锁”，这样在对子表高并发进行写入操作的情况下，对父表的写入操作就会由于“共享锁”的存在，而会长时间不能得到更新。</p>
<p>其次，外键并不是不可替代的，只要后端逻辑处理得当完全可以避免外键的使用，而且在逻辑上也是很简单的，所以我更倾向于使用这种方法。</p>
<p>部分参考：<a target="_blank" rel="noopener" href="https://draveness.me/whys-the-design-database-foreign-key/%EF%BC%8Cta%E8%AE%B2%E7%9A%84%E7%9C%9F%E5%A5%BD">https://draveness.me/whys-the-design-database-foreign-key/，ta讲的真好</a></p>
<p> </p>
<h1>5.#与$：SQL的细微知识</h1>
<h2 id="问题发现：">问题发现：</h2>
<p>在调用SQL语句进行update的时候一直出现实体类与数据库字段不匹配问题，<code>java.sql.SQLSyntaxErrorException: Unknown column 'xxx' in 'field list'</code>,但这其实是一个非常常见的错误，最诡异的是报错是这样的：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="3.png" alt=""></p>
<p>SQL语句：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="4.png" alt=""></p>
<p>按道理讲，SQL语句应该是毫无问题的，我的select等等其他方法也是用类似的格式写的，但这个update偏偏不行，而且最诡异的是一个数据被识别为了数据表的列名，这就让人十分迷惑。</p>
<p>最后，我将引用数据的方法${}改成了#{}，解决了这个问题。</p>
<h2 id="分析：">分析：</h2>
<h3 id="二者区别：">二者区别：</h3>
<p>首先，在MyBatis 的映射配置文件中，动态传递参数有两种方式：</p>
<ul>
<li>
<p>#{} 占位符</p>
</li>
<li>
<p>${} 拼接符</p>
</li>
</ul>
<p>其次：</p>
<ul>
<li>
<p>#{} 为参数占位符 ?，即sql 预编译，${} 为字符串替换，即 sql 拼接</p>
</li>
<li>
<p>#{}：动态解析 -&gt; 预编译 -&gt; 执行，${}：动态解析 -&gt; 编译 -&gt; 执行</p>
</li>
<li>
<p>#{} 的变量替换是在DBMS 中，${} 的变量替换是在 DBMS 外</p>
</li>
</ul>
<blockquote>
<p>DBMS: Database Management System，数据库管理系统</p>
</blockquote>
<ul>
<li>
<p>变量替换后，#{} 对应的变量自动加上单引号 ‘’，变量替换后，${} 对应的变量不会加上单引号 ‘’</p>
</li>
<li>
<p>#{} 能防止sql 注入，${} 不能防止sql 注入</p>
</li>
</ul>
<h3 id="样例：">样例：</h3>
<p>#{} 和 ${} 的实例：假设传入参数为 1</p>
<ul>
<li>开始</li>
</ul>
<p>1）<code>#&#123;&#125;：select * from t_user where uid=#&#123;uid&#125;</code></p>
<p>2）<code>$&#123;&#125;：select * from t_user where uid= '$&#123;uid&#125;'</code></p>
<ul>
<li>然后</li>
</ul>
<p>1）<code>#&#123;&#125;：select * from t_user where uid= ?</code></p>
<p>2）<code>$&#123;&#125;：select * from t_user where uid= 1</code></p>
<ul>
<li>最后</li>
</ul>
<p>1）<code>#&#123;&#125;：select * from t_user where uid= '1'</code></p>
<p>2）<code>$&#123;&#125;：select * from t_user where uid= 1</code></p>
<h3 id="注意事项：">注意事项：</h3>
<ul>
<li>能用<code>#&#123;&#125;</code>的地方就用<code> #&#123;&#125;</code>，不用或少用 <code>$&#123;&#125;</code>。因为使用<code>$&#123; &#125;</code>会导致sql注入，不利于系统的安全性！</li>
</ul>
<blockquote>
<p>SQL注入：就是通过把SQL命令插入到Web表单提交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。常见的有匿名登录（在登录框输入恶意的字符串）、借助异常获取数据库信息等</p>
</blockquote>
<ul>
<li>表名作参数时，必须用 <code>$&#123;&#125;。如：select * from $&#123;tableName&#125;</code></li>
<li>order by 时，必须用 <code>$&#123;&#125;。如：select * from t_user order by $&#123;columnName&#125;</code></li>
<li>使用 <code>$&#123;&#125; </code>时，要注意何时加或不加单引号，即<code> $&#123;&#125;</code> 和 <code>'$&#123;&#125;'</code></li>
</ul>
<h2 id="11-24又踩了一坑：">11.24又踩了一坑：</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="7.png" alt=""></p>
<p>完整的第一行如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nested exception is org.apache.ibatis.type.TypeException: Could not set parameters <span class="keyword">for</span> mapping: ParameterMapping&#123;property=<span class="string">&#x27;sid&#x27;</span>, mode=IN, javaType=<span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Object</span>, <span class="title">jdbcType</span></span>=<span class="keyword">null</span>, numericScale=<span class="keyword">null</span>, resultMapId=<span class="string">&#x27;null&#x27;</span>, jdbcTypeName=<span class="string">&#x27;null&#x27;</span>, expression=<span class="string">&#x27;null&#x27;</span>&#125;. Cause: org.apache.ibatis.type.TypeException: Error setting non <span class="keyword">null</span> <span class="keyword">for</span> parameter #<span class="number">2</span> with JdbcType <span class="keyword">null</span> . Try setting a different JdbcType <span class="keyword">for</span> <span class="keyword">this</span> parameter or a different configuration property. Cause: org.apache.ibatis.type.TypeException: Error setting non <span class="keyword">null</span> <span class="keyword">for</span> parameter #<span class="number">2</span> with JdbcType <span class="keyword">null</span> . Try setting a different JdbcType <span class="keyword">for</span> <span class="keyword">this</span> parameter or a different configuration property. Cause: java.sql.SQLException: <span class="function">Parameter index out of <span class="title">range</span> <span class="params">(<span class="number">2</span> &gt; number of parameters, which is <span class="number">1</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>发现在字段映射过程中多了一些奇奇怪怪的字段，换成<code>$&#123;&#125;</code>就恢复正常了。现在猜测<code>$&#123;&#125;</code>与<code>#&#123;&#125;</code>之间的区别可能没那么简单。但是看报错类型是<code>MyBatisSystemException</code>，也可能是<code>MyBatis</code>在封装过程中产生的问题。</p>
<p>但是，其实<code>#&#123;&#125;</code>外面不需要加’'。删掉就好了</p>
<p> </p>
<h1>6.PBE加密：</h1>
<h2 id="1-概述">1.概述</h2>
<p>PBE(Password Based Encryption，基于口令加密)是一种基于口令的加密算法，其特点是使用口令代替了密钥，而口令由用户自己掌管，采用随机数(这里称之为 盐)杂凑多重加密等方法保证数据的安全性。</p>
<p>PBE 算法并没有 真正构建新的加密/解密算法，而是对已知的对称加密算法(eg:DES算法)做了包装；使用PBE算法对数据做加密/解密操作时，其实是使用了 DES 或者 AES 等其他对称加密算法做了相应的操作。</p>
<p>既然，PBE算法是使用了较为常用的对称加密算法，那就无法回避密钥的问题；**口令并不能替代密钥，密钥是经过加密算法计算得出的，但口令本身不可能很长，单纯的口令很容易通过穷举攻击方式破译，这就引入了 “盐”。盐能够阻止字典攻击或预先计算的攻击，本身是一个随机的信息，相同的随机信息极不可能使用2次。**将盐附加在 口令上，通过消息摘要算法经过迭代计算获取得到 构建密钥/初始化向量的基本材料，使得破译加密信息的难度加大。</p>
<h2 id="2-模型图（UML）">2.模型图（UML）</h2>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="5.png" alt=""></p>
<h2 id="3-实现">3.实现</h2>
<p><code>import org.bouncycastle.jce.provider.BouncyCastleProvider;</code>在idea中可以Maven搜索找到，<code>pom.xml</code>可以通过如下引入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--口令加密--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bouncycastle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bcprov-jdk16<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.46<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以下代码参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/Leon_Jinhai_Sun/article/details/89919308">Leon_Jinhai_Sun的代码</a>，有删改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"><span class="keyword">import</span> java.security.Security;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEKeySpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEParameterSpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.bouncycastle.jce.provider.BouncyCastleProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PBECipher</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 首先我们要Castle的jar包引入到项目中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ALGORITHM = <span class="string">&quot;PBEWITHMD5andDES&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String CIPHER_NAME = <span class="string">&quot;PBEwithSHA1and128bitAES-CBC-BC&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ITERATION_COUNT = <span class="number">1000</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加密</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encrypt(String password, <span class="keyword">byte</span>[] salt, <span class="keyword">byte</span>[] input) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 我们在加密的时候需要创建一个PBEKeySpec</span></span><br><span class="line"><span class="comment">         * 还有传入的用户输入的password</span></span><br><span class="line"><span class="comment">         * 得到一个PBEKeySpec对象</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        PBEKeySpec keySpec = <span class="keyword">new</span> PBEKeySpec(password.toCharArray());</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 然后我们通过SecretKeyFactory</span></span><br><span class="line"><span class="comment">         * 通过getInstance方法</span></span><br><span class="line"><span class="comment">         * 得到一个SecretKeyFactory对象</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        SecretKeyFactory sKeyFactory = SecretKeyFactory</span><br><span class="line">                .getInstance(CIPHER_NAME);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 然后通过generateSecret传入keySpec</span></span><br><span class="line"><span class="comment">         * 就可以得到一个SecretKey</span></span><br><span class="line"><span class="comment">         * 这个SecretKey就是我们将来要加密的密钥</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        SecretKey skey = sKeyFactory.generateSecret(keySpec);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 紧接着我们要通过salt生成一个PBEParameterSpec</span></span><br><span class="line"><span class="comment">         * 我们传入1000</span></span><br><span class="line"><span class="comment">         * 表示用户的口令和salt会走1000次的循环</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        PBEParameterSpec pbeps = <span class="keyword">new</span> PBEParameterSpec(salt, ITERATION_COUNT);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 然后我们通过Cipher.getInstance得到一个Cipher对象</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(CIPHER_NAME);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * init方法会传入ENCRYPT_MODE,SecretKey,</span></span><br><span class="line"><span class="comment">         * 以及PBEParameterSpec这三个对象然后就可以加密</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, skey, pbeps);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 得到密文</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(input);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解密</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 在解密的时候我们需要传入用户需要的password,salt,以及密文</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] decrypt(String password, <span class="keyword">byte</span>[] salt, <span class="keyword">byte</span>[] input) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        PBEKeySpec keySpec = <span class="keyword">new</span> PBEKeySpec(password.toCharArray());</span><br><span class="line">        SecretKeyFactory sKeyFactory = SecretKeyFactory</span><br><span class="line">                .getInstance(CIPHER_NAME);</span><br><span class="line">        SecretKey skey = sKeyFactory.generateSecret(keySpec);</span><br><span class="line">        PBEParameterSpec pbeps = <span class="keyword">new</span> PBEParameterSpec(salt, ITERATION_COUNT);</span><br><span class="line">        Cipher cipher = Cipher.getInstance(CIPHER_NAME);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 然后我们把模式设置为DECRYPT_MODE</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, skey, pbeps);</span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(input);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 我们运行这个代码</span></span><br><span class="line"><span class="comment">     * 由于我们每次运行的salt是不同的</span></span><br><span class="line"><span class="comment">     * 所以每次我们得到密文也是不同的</span></span><br><span class="line"><span class="comment">     * 通过用户口令和随机数</span></span><br><span class="line"><span class="comment">     * 我们就保证了加密的强度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 把BouncyCastle作为Provider添加到java.security：</span></span><br><span class="line">        Security.addProvider(<span class="keyword">new</span> BouncyCastleProvider());</span><br><span class="line">        <span class="comment">// 原文：</span></span><br><span class="line">        String message = <span class="string">&quot;Hello, world! encrypted using PBE!&quot;</span>;</span><br><span class="line">        <span class="comment">// 加密口令</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 我们设置一个加密口令password hello123456</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        String password = <span class="string">&quot;hello12345&quot;</span>;</span><br><span class="line">        <span class="comment">// 16 bytes随机Salt：</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 我们通过SecureRandom.getInstanceStrong().generateSeed生成一个随机salt</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">byte</span>[] salt = SecureRandom.getInstanceStrong().generateSeed(<span class="number">16</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 我们打印这个salt</span></span><br><span class="line"><span class="comment">         * salt: d4356ec3e5621a8f1f6a7be953b0c31e</span></span><br><span class="line"><span class="comment">         * 我们生成的随机的salt</span></span><br><span class="line"><span class="comment">         * 1个16字节的数组</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;salt: %032x\n&quot;</span>, <span class="keyword">new</span> BigInteger(<span class="number">1</span>, salt));</span><br><span class="line">        <span class="comment">// 加密：</span></span><br><span class="line">        <span class="keyword">byte</span>[] data = message.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 然后调用encrypt方法进行加密</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">byte</span>[] encrypted = encrypt(password, salt, data);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 加密以后的密文是用Base64表示的</span></span><br><span class="line"><span class="comment">         * encrypted: 2MnA9wd1IL4n0W3d3nS5dqZ6dj1fcxZI2GJtKKIDYchw1EkodmJeOLIQpUBendR+</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="string">&quot;encrypted: &quot;</span> + Base64.getEncoder().encodeToString(encrypted));</span><br><span class="line">        <span class="comment">// 解密：</span></span><br><span class="line">        <span class="keyword">byte</span>[] decrypted = decrypt(password, salt, encrypted);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 解密以后得到与原文相同的信息</span></span><br><span class="line"><span class="comment">         * Hello, world! encrypted using PBE!</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="keyword">new</span> String(decrypted, StandardCharsets.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-踩坑：">4.踩坑：</h2>
<p>任何对<code>byte[]</code>的类型转换都会导致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javax.crypto.BadPaddingException: pad block corrupted</span><br></pre></td></tr></table></figure>
<p>但是直接将byte[]存进数据库是不可能的，所以暂时没有解决方案。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="6.png" alt=""></p>
<p> </p>
<h1>7.BCrypt加密</h1>
<h2 id="一、概述">一、概述</h2>
<p>我们常常通过一些不可逆的算法来保存用户的密码。比如：MD5, SHA1, SHA256, SHA512, SHA-3,等Hash算法。这些算法都是不可逆的。系统在验证用户的口令时，需要把Hash加密过后的口令与后面存放口令的数据库中的口令做比较，如果一致才算验证通过。但你觉得这些算法好吗？我说的是：MD5, SHA1, SHA256, SHA512, SHA-3。如果你使用的是MD5算法来加密你的口令，如果你的口令长度只有小写字母再加上数字，假设口令的长度是6位，那么在目前一台比较新一点的PC机上，穷举所有的口令只需要40秒钟。而据我们了解，几乎有90%以上的用户只用小写字母和数字来组织其口令。对于6位长度的密码只需要最多40秒就可以破解了，这可能会吓到你。如果你愿意花2000美金和一周的时间来构建一个CUDA，那么，你可以在你组建的这个集群中使用进行密码穷举运算，其速度是，1秒钟可以计算7亿个口令。对于目前实际当中使用的比较复杂的口令，其破解率也可以高达每秒一个。当然，这里说的算法是MD5，SHA之类的算法。</p>
<p>​    那么，对于这样的一种情况来说，我们怎么办？我们还是有办法的。我们知道MD5，SHA的算法速度太快了。所以，我们需要一个“慢一点”的加密算法。<code>BCrypt</code>是这样的一个算法，因为它很慢，对于计算机来说，其慢得有点BT了，但却慢得刚刚好！对于验证用户口令来说是不慢的，对于穷举用户口令来说，其会让那些计算机变得如同蜗牛一样。因为<code>BCrypt</code>采用了一系列各种不同的Blowfish加密算法，并引入了一个work factor，这个工作因子可以让你决定这个算法的代价有多大。因为这些，这个算法不会因为计算机CPU处理速度变快了，而导致算法的时间会缩短了。因为，你可以增加work factor来把其性能降下来。那么，<code>BCrypt</code>到底有多慢？如果和MD5一起来比较的话，如果使用值为12的work factor的话，如果加密“cool”的话，<code>BCrypt</code>需要0.3秒，而MD5只需要一微秒（百万分之一秒）。也就是说，前面我们说的那个只需要40秒就可以穷举完所有的可能的MD5编码的口令的算法，在使用<code>BCrypt</code>下，需要12年。这就是<code>BCrypt</code>给你带来的选择，你可以一个安全的口令和一个快速的加密算法，或是一个不怎么安全的口令和一个性能不好的加密算法。</p>
<p>​    总而言之，<code>BCrypt</code>是一个哈希算法，一个明文映射多个密文，但是相同密文不同密文校验值<code>BCrypt.checkpw</code>一致；相比于MD5，更安全，速度慢。</p>
<h2 id="二、JAVA实现">二、JAVA实现</h2>
<p>转自： <a target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/48942">https://yq.aliyun.com/articles/48942</a></p>
<p>1.官网下载源码：<a target="_blank" rel="noopener" href="http://www.mindrot.org/projects/jBCrypt/">http://www.mindrot.org/projects/jBCrypt/</a></p>
<p>2.将BCrypt.java拷贝到项目下，使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> EncryptAndDecrypt;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* BCrypt Java实现</span></span><br><span class="line"><span class="comment">* BCrypt也是一种哈希算法，相比MD5更安全，速度慢</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UseBCrypt</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">        Scanner scanner=<span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入密码：&quot;</span>);</span><br><span class="line">        String password=scanner.nextLine();<span class="comment">//明文</span></span><br><span class="line">        System.out.println(<span class="string">&quot;请输入待验证密码：&quot;</span>);</span><br><span class="line">        String candidate=scanner.nextLine();</span><br><span class="line">        <span class="comment">// 第一次哈希一个password</span></span><br><span class="line">        String hashed = BCrypt.hashpw(password, BCrypt.gensalt());<span class="comment">//密文</span></span><br><span class="line">        <span class="comment">// gensalt&#x27;s log_rounds parameter determines the complexity</span></span><br><span class="line">        <span class="comment">// the work factor is 2**log_rounds, and the default is 10</span></span><br><span class="line">        String hashed2 = BCrypt.hashpw(password, BCrypt.gensalt(<span class="number">12</span>));</span><br><span class="line">        System.out.println(hashed);</span><br><span class="line">        System.out.println(hashed2);</span><br><span class="line">        <span class="comment">//密码密文匹配检测</span></span><br><span class="line">        <span class="keyword">if</span> (BCrypt.checkpw(candidate, hashed))</span><br><span class="line">            System.out.println(<span class="string">&quot;It matches&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            System.out.println(<span class="string">&quot;It does not match&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">请输入密码：</span><br><span class="line"><span class="number">123456</span></span><br><span class="line">请输入待验证密码：</span><br><span class="line"><span class="number">234563</span></span><br><span class="line">$2a$<span class="number">10</span>$RbX30iBRU0/rZtY9itIYF.F7PlqZAkHuYQFDDSE9ESOU9z.i.1gZu</span><br><span class="line">$2a$<span class="number">12</span>$waisaCtTw8EvT/ddNEz1kOFPdIAHHIfPQk0QhOLGSAcgDPjCv5s0K</span><br><span class="line">It does not match</span><br></pre></td></tr></table></figure>
<p> </p>
<h1>8.密码重置的策略：</h1>
<p>首先要确定学号与邮箱是否正确，确认正确后向邮箱发送确认邮件。</p>
<p>一般来说，确认邮件中包含一个连接，用户点击链接进行确认，这就意味着，该链接只能是单次有效的，并且不同用户应该会获取到不同链接。使用的策略如下：</p>
<p>首先，请求方式使用get请求，因为设计的URL中不会包含任何敏感信息。其次URL的参数中必然包含学号用以确定身份，然后要解决URL的<strong>唯一性与单次有效性</strong>问题，我采取的策略是使用一个&quot;token&quot;。</p>
<p>其次，数据库中用于存放加密后的密码的<code>column</code>叫<code>passwordData</code>，我如果想要生成一个随机的、单次有效的token，只靠随机数肯定不行，（众所周知java的随机数是伪随机），受到上面PBE与现实中真正随机数的产生策略的启发，我的解决方案如下：</p>
<ul>
<li><strong>首先获取当前时间与用户学号拼接形成一个字符串</strong>（加学号是防止并发量过大的情况下同一时间生成字符串相同，其实也大可不必担心因为下文会使用随机盐值进行加密，生成相同序列的几率微乎其微）</li>
<li><strong>获取一个随机的16位salt（byte[])，使用PBE调用SHA1进行加密</strong>，由于SHA1是取哈希的非对称加密，且速度非常快，可以认为对并发量不会有太大影响。（但也正因如此现实中应该加一个冷却期才对）。<strong>生成的Base64序列转为字符串即是我要的&quot;token&quot;。</strong></li>
<li><strong>将生成的的&quot;token&quot;更新到表的<code>passwordData</code>下</strong>，这意味着这期间用户将不能登陆。并将重置密码的URL发送到用户邮箱，<strong>点击URL后比对URL中的token与该学号下的<code>passwordData</code>的内容，若一致，将<code>passwordData</code>的内容替换为123456的加密序列即可</strong>。若不一致，可能token错误或者重新进行了重置密码的申请。</li>
<li>以上解决了唯一性与单次有效性，因为token在验证完成后就会被抹去，就算用户再次点击重置的链接也只会显示&quot;token已过期&quot;。</li>
</ul>
<p> </p>
<h1>9.发送邮件的问题：</h1>
<p>上面提到了发送邮件，方法如下：</p>
<p>pom.xml引入：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置文件中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring:  </span><br><span class="line">  mail:</span><br><span class="line">    host: smtp地址</span><br><span class="line">    username: 邮箱地址即可</span><br><span class="line">    password: 密码或授权码</span><br><span class="line">    properties:</span><br><span class="line">      from: 邮箱地址</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.JavaMailSenderImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailSender</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Autowired</span></span><br><span class="line">        <span class="keyword">public</span> JavaMailSenderImpl mailSender;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">sendMimeMail</span><span class="params">(String mail)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                MimeMessageHelper messageHelper = <span class="keyword">new</span> MimeMessageHelper(mailSender.createMimeMessage(), <span class="keyword">true</span>);</span><br><span class="line"> messageHelper.setFrom(mailSender.getJavaMailProperties().getProperty(<span class="string">&quot;from&quot;</span>));</span><br><span class="line">                messageHelper.setTo(mail);</span><br><span class="line">                messageHelper.setText(<span class="string">&quot;text&quot;</span>);</span><br><span class="line">                mailSender.send(messageHelper.getMimeMessage());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用该方法的时候：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">MailSender mailSender;</span><br></pre></td></tr></table></figure>
<p>然后调用方法即可。</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1598632">该文章</a>有参考，但有坑。</p>
<p> </p>
<h1>10.动态SQL强大之处</h1>
<h2 id="前言">前言</h2>
<p>这次后端开发中并没有像往常一样使用实体类与数据库表进行映射，一方面，这次数据库表耦合度比较高，我选择了将所有信息耦合在一起的方法减少多表联查并且直接取代了外键，虽然在实际应用中这是非常不可取的（频繁地对同一张表进行读写不仅导致服务器压力大而且在并发量较大时难以保证事务一致性）而且还会存在大量的数据冗余导致空间利用率其实是偏低的，但是好处也十分明显，在处理后端时可以大大减少开发的工作量，但也仅限于这个小项目而已。</p>
<p>另一方面，我需要能从一张数据表中组装出多个实体对象，这就意味着我不可能使用上述的映射关系。其实这种抉择也是当下形式的一个缩影，近年来很多人吹捧“低代码”这一概念，声称用几行代码就可以构建一个服务，但其实这种便捷性也会使得调用者付出巨大的代价，就是不可避免的“可定制性”或者说“自由度&quot;的降低，与代码的封装其实是一个道理，如何取舍其实还是要看开发需求。</p>
<h2 id="个人感受">个人感受</h2>
<p>不是特别想讲动态SQL，这方面个人感觉官网讲的已经非常明白了（<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/dynamic-sql.html">传送门</a>），这里说一些个人使用体验。</p>
<p>以下纯属个见解。</p>
<h3 id="1-条件性select">1.条件性select</h3>
<p>首先，动态SQL是<code>myBatis</code>整个架构中特别重要的一环，它的出现即继承了SpringBoot自动装配简化工作量的优势，也解决了SQL查询的一些拓展性或者说灵活性的问题。MySQL的关键字固然有很多，但是其实很大一部分在初级甚至中级开发中很少用得到。但与之对应的我们在查询时往往有多个条件一起用于查询或者只是想从多个条件中选择一个使用，传统的SQL对此束手无策（好像），以至于这个问题一直臭名昭著，但是利用动态SQL的<code>if</code>,<code>when</code>等就可以很好地解决这一问题，大大减少查询的工作量与复杂度。</p>
<h4 id="一个问题">一个问题</h4>
<p>但其实这也会带来一个问题，官网也有提到，并给出了一个解决方案：</p>
<blockquote>
<p>对于下面的SQL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;findActiveBlogLike&quot;</span><br><span class="line">     resultType=&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  WHERE</span><br><span class="line">  &lt;if test=&quot;state != null&quot;&gt;</span><br><span class="line">    state = #&#123;state&#125;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">  &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">  &lt;if test=&quot;author != null and author.name != null&quot;&gt;</span><br><span class="line">    AND author_name like #&#123;author.name&#125;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>如果没有匹配的条件会怎么样？最终这条 SQL 会变成这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM BLOG</span><br><span class="line">WHERE</span><br></pre></td></tr></table></figure>
<p>这会导致查询失败。如果匹配的只是第二个条件又会怎样？这条 SQL 会是这样:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM BLOG</span><br><span class="line">WHERE</span><br><span class="line">AND title like ‘someTitle’</span><br></pre></td></tr></table></figure>
<p>这个查询也会失败。这个问题不能简单地用条件元素来解决。这个问题是如此的难以解决，以至于解决过的人不会再想碰到这种问题。</p>
<p>MyBatis 有一个简单且适合大多数场景的解决办法。而在其他场景中，可以对其进行自定义以符合需求。而这，只需要一处简单的改动：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;findActiveBlogLike&quot;</span><br><span class="line">     resultType=&quot;Blog&quot;&gt;</span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  &lt;where&gt;</span><br><span class="line">    &lt;if test=&quot;state != null&quot;&gt;</span><br><span class="line">         state = #&#123;state&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;title != null&quot;&gt;</span><br><span class="line">        AND title like #&#123;title&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;author != null and author.name != null&quot;&gt;</span><br><span class="line">        AND author_name like #&#123;author.name&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p><em>where</em> 元素只会在子元素返回任何内容的情况下才插入 “WHERE” 子句。而且，若子句的开头为 “AND” 或 “OR”，<em>where</em> 元素也会将它们去除。</p>
<p><strong>如果 <em>where</em> 元素与你期望的不太一样，你也可以通过自定义 trim 元素来定制 <em>where</em> 元素的功能</strong>。比如，和 <em>where</em> 元素等价的自定义 trim 元素为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;trim prefix=&quot;WHERE&quot; prefixOverrides=&quot;AND |OR &quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/trim&gt;</span><br></pre></td></tr></table></figure>
<p><em>prefixOverrides</em> 属性会忽略通过管道符分隔的文本序列（注意此例中的空格是必要的）。上述例子会移除所有 <em>prefixOverrides</em> 属性中指定的内容，并且插入 <em>prefix</em> 属性中指定的内容。</p>
<p>用于动态更新语句的类似解决方案叫做 <em>set</em>。<em>set</em> 元素可以用于动态包含需要更新的列，忽略其它不更新的列。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=&quot;updateAuthorIfNecessary&quot;&gt;</span><br><span class="line">  update Author</span><br><span class="line">    &lt;set&gt;</span><br><span class="line">      &lt;if test=&quot;username != null&quot;&gt;username=#&#123;username&#125;,&lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;password != null&quot;&gt;password=#&#123;password&#125;,&lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;email != null&quot;&gt;email=#&#123;email&#125;,&lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;bio != null&quot;&gt;bio=#&#123;bio&#125;&lt;/if&gt;</span><br><span class="line">    &lt;/set&gt;</span><br><span class="line">  where id=#&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>
<p>这个例子中，<em>set</em> 元素会动态地在行首插入 SET 关键字，并会删掉额外的逗号（这些逗号是在使用条件语句给列赋值时引入的）。</p>
</blockquote>
<blockquote>
<p>来看看与 <em>set</em> 元素等价的自定义 <em>trim</em> 元素吧：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;trim prefix=&quot;SET&quot; suffixOverrides=&quot;,&quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/trim&gt;</span><br></pre></td></tr></table></figure>
<p>注意，我们覆盖了后缀值设置，并且自定义了前缀值。</p>
</blockquote>
<h3 id="2-foreach遍历">2.foreach遍历</h3>
<p><code>foreach</code>对于java来说非常常见的但对于SQL来说却并不，按照官网的说法：</p>
<blockquote>
<p><em>foreach</em> 元素的功能非常强大，它允许你指定一个集合，声明可以在元素体内使用的集合项（item）和索引（index）变量。它也允许你指定开头与结尾的字符串以及集合项迭代之间的分隔符。这个元素也不会错误地添加多余的分隔符</p>
</blockquote>
<p>而尤其在IN语句中是非常实用的，不过这次并没怎么用到就不说太多了。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://ZWN2001.github.io">ZWN</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zwn2001.github.io/2021/11/06/2021%E9%99%90%E9%80%89%E8%AF%BEweb%E8%B8%A9%E5%9D%91%E6%B1%87%E6%80%BB/">https://zwn2001.github.io/2021/11/06/2021%E9%99%90%E9%80%89%E8%AF%BEweb%E8%B8%A9%E5%9D%91%E6%B1%87%E6%80%BB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://ZWN2001.github.io" target="_blank">ZWN's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a></div><div class="post_share"><div class="social-share" data-image="/img/cover1/6.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/10/27/%E7%BD%91%E7%BB%9C%E7%9A%84%E5%BC%82%E6%AD%A5/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover3/22-min.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">网络的异步与okhttp</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/17/%E5%AD%A6%E7%BA%BF%E7%A7%BB%E5%8A%A8%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BE%8B%E4%BC%9A/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover2/8-min.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">学线移动第一次例会</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ZWN</div><div class="author-info__description">我虽无意逐鹿，却知苍生苦楚</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ZWN2001"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ZWN2001" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">建议使用无痕模式以更快地得到更新，或者访问新站https://zwn-2001-github-io.vercel.app/而非github page,github page将在九月停止运营</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">前言：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">1.computed和methods的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#computed"><span class="toc-number">2.1.</span> <span class="toc-text">computed</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BA%E5%88%AB"><span class="toc-number">2.2.</span> <span class="toc-text">区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">2.3.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">2.跨域</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E8%B7%A8%E5%9F%9FHTTP%E8%AF%B7%E6%B1%82"><span class="toc-number">3.1.</span> <span class="toc-text">一、什么是跨域HTTP请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81CROS%E5%B8%B8%E8%A7%81header"><span class="toc-number">3.2.</span> <span class="toc-text">二、CROS常见header</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81CORS%E5%AE%9E%E7%8E%B0%E8%B7%A8%E5%9F%9F%E8%AE%BF%E9%97%AE"><span class="toc-number">3.3.</span> <span class="toc-text">三、CORS实现跨域访问</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%BF%94%E5%9B%9E%E6%96%B0%E7%9A%84CorsFilter-%E5%85%A8%E5%B1%80%E8%B7%A8%E5%9F%9F"><span class="toc-number">3.3.1.</span> <span class="toc-text">1.返回新的CorsFilter(全局跨域)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-filter-%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F"><span class="toc-number">3.3.2.</span> <span class="toc-text">2.创建一个 filter 解决跨域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%87%8D%E5%86%99WebMvcConfigurer%EF%BC%88%E5%85%A8%E5%B1%80%E8%B7%A8%E5%9F%9F%EF%BC%89"><span class="toc-number">3.3.3.</span> <span class="toc-text">3. 重写WebMvcConfigurer（全局跨域）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%EF%BC%88%E5%B1%80%E9%83%A8%E8%B7%A8%E5%9F%9F%EF%BC%89"><span class="toc-number">3.3.4.</span> <span class="toc-text">4. 使用注解（局部跨域）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%89%8B%E5%B7%A5%E8%AE%BE%E7%BD%AE%E5%93%8D%E5%BA%94%E5%A4%B4%EF%BC%88%E5%B1%80%E9%83%A8%E8%B7%A8%E5%9F%9F-%EF%BC%89"><span class="toc-number">3.3.5.</span> <span class="toc-text">5.手工设置响应头（局部跨域 ）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">3.判断合法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%97"><span class="toc-number">4.1.</span> <span class="toc-text">数字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%82%AE%E7%AE%B1"><span class="toc-number">4.2.</span> <span class="toc-text">邮箱</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">4.我为什么不用外键</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">5.#与$：SQL的细微知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%8F%91%E7%8E%B0%EF%BC%9A"><span class="toc-number">6.1.</span> <span class="toc-text">问题发现：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90%EF%BC%9A"><span class="toc-number">6.2.</span> <span class="toc-text">分析：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E8%80%85%E5%8C%BA%E5%88%AB%EF%BC%9A"><span class="toc-number">6.2.1.</span> <span class="toc-text">二者区别：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B7%E4%BE%8B%EF%BC%9A"><span class="toc-number">6.2.2.</span> <span class="toc-text">样例：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9A"><span class="toc-number">6.2.3.</span> <span class="toc-text">注意事项：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-24%E5%8F%88%E8%B8%A9%E4%BA%86%E4%B8%80%E5%9D%91%EF%BC%9A"><span class="toc-number">6.3.</span> <span class="toc-text">11.24又踩了一坑：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">6.PBE加密：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A6%82%E8%BF%B0"><span class="toc-number">7.1.</span> <span class="toc-text">1.概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%A8%A1%E5%9E%8B%E5%9B%BE%EF%BC%88UML%EF%BC%89"><span class="toc-number">7.2.</span> <span class="toc-text">2.模型图（UML）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.3.</span> <span class="toc-text">3.实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%B8%A9%E5%9D%91%EF%BC%9A"><span class="toc-number">7.4.</span> <span class="toc-text">4.踩坑：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">7.BCrypt加密</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="toc-number">8.1.</span> <span class="toc-text">一、概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81JAVA%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.2.</span> <span class="toc-text">二、JAVA实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">8.密码重置的策略：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">10.</span> <span class="toc-text">9.发送邮件的问题：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">11.</span> <span class="toc-text">10.动态SQL强大之处</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">11.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AA%E4%BA%BA%E6%84%9F%E5%8F%97"><span class="toc-number">11.2.</span> <span class="toc-text">个人感受</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9D%A1%E4%BB%B6%E6%80%A7select"><span class="toc-number">11.2.1.</span> <span class="toc-text">1.条件性select</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98"><span class="toc-number">11.2.1.1.</span> <span class="toc-text">一个问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-foreach%E9%81%8D%E5%8E%86"><span class="toc-number">11.2.2.</span> <span class="toc-text">2.foreach遍历</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/08/08/sdu-software-clubs/" title="sdu-software-clubs"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover2/13-min.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="sdu-software-clubs"/></a><div class="content"><a class="title" href="/2022/08/08/sdu-software-clubs/" title="sdu-software-clubs">sdu-software-clubs</a><time datetime="2022-08-08T12:29:08.000Z" title="发表于 2022-08-08 20:29:08">2022-08-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/07/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E6%8A%8A%E5%AE%A2%E5%88%B6%E5%8C%96%E9%94%AE%E7%9B%98KeyChronQ3/" title="我的第一把客制化键盘KeyChron Q3"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover3/14-min.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="我的第一把客制化键盘KeyChron Q3"/></a><div class="content"><a class="title" href="/2022/08/07/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E6%8A%8A%E5%AE%A2%E5%88%B6%E5%8C%96%E9%94%AE%E7%9B%98KeyChronQ3/" title="我的第一把客制化键盘KeyChron Q3">我的第一把客制化键盘KeyChron Q3</a><time datetime="2022-08-07T03:18:13.000Z" title="发表于 2022-08-07 11:18:13">2022-08-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/31/jjwt-0-9-1%E9%80%A0%E6%88%90%E7%9A%84token%E7%AD%BE%E5%8F%91%E6%97%B6base64%E7%BC%96%E7%A0%81%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98/" title="jjwt-0.9.1造成的token签发时base64编码错误问题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover2/7-min.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="jjwt-0.9.1造成的token签发时base64编码错误问题"/></a><div class="content"><a class="title" href="/2022/07/31/jjwt-0-9-1%E9%80%A0%E6%88%90%E7%9A%84token%E7%AD%BE%E5%8F%91%E6%97%B6base64%E7%BC%96%E7%A0%81%E9%94%99%E8%AF%AF%E9%97%AE%E9%A2%98/" title="jjwt-0.9.1造成的token签发时base64编码错误问题">jjwt-0.9.1造成的token签发时base64编码错误问题</a><time datetime="2022-07-31T08:44:11.000Z" title="发表于 2022-07-31 16:44:11">2022-07-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/27/%E6%9A%91%E6%9C%9F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%BC%95%E8%AE%BA/" title="暑期机器学习引论"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover1/11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="暑期机器学习引论"/></a><div class="content"><a class="title" href="/2022/07/27/%E6%9A%91%E6%9C%9F%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%BC%95%E8%AE%BA/" title="暑期机器学习引论">暑期机器学习引论</a><time datetime="2022-07-27T07:08:05.000Z" title="发表于 2022-07-27 15:08:05">2022-07-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/24/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1%E4%BD%BF%E7%94%A8%E4%B9%8B%E8%B7%AF/" title="支付宝沙箱使用之路"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover3/18-min.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="支付宝沙箱使用之路"/></a><div class="content"><a class="title" href="/2022/07/24/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%B2%99%E7%AE%B1%E4%BD%BF%E7%94%A8%E4%B9%8B%E8%B7%AF/" title="支付宝沙箱使用之路">支付宝沙箱使用之路</a><time datetime="2022-07-24T14:36:34.000Z" title="发表于 2022-07-24 22:36:34">2022-07-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/cover1/6.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By ZWN</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">喵喵喵？</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '7MlJqmD9Ceux2bxiKqPqsMHW-gzGzoHsz',
      appKey: '3oP9XaednBAwtfMk2q28dwGP',
      avatar: 'retro',
      serverURLs: 'https://7mljqmd9.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="app-refresh" id="app-refresh"> <div class="app-refresh-wrap"> <label>✨ 网站已更新最新版本 👉</label> <a href="javascript:void(0)" onclick="location.reload()">点击刷新</a> </div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"已更新最新版本",backgroundColor:t,duration:5e5,pos:e,actionText:"点击刷新",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",function(){showNotification()}),window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js")}));</script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>